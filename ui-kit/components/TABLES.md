## Компонент: Таблицы

Таблицы используются для отображения и, в некоторых случаях, редактирования наборов структурированных данных.

### 1. Общая структура

-   **Контейнер**: Имеет рамку (`border`), тень (`shadow-sm`) и скругленные углы (`rounded-lg`). Содержимое скроллится по горизонтали на малых экранах (`overflow-x-auto`).
-   **Заголовок (`<thead>`)**:
    -   Имеет светло-серый фон (`bg-gray-50`).
    -   Текст заголовков — `text-xs`, `font-medium`, `uppercase`, `text-gray-500`.
-   **Тело (`<tbody>`)**:
    -   **Разделители строк**: Для создания визуального отступа между строками используется нижняя граница (`border-b`), цвет которой совпадает с цветом фона страницы (`bg-gray-50`). Это создает эффект "пробела" между строками. Для последней строки граница убирается с помощью `last:border-b-0`.
    -   **Пример**: `<tr class="border-b border-gray-50 last:border-b-0">...</tr>`
    -   **Запрещено**: Использовать утилиты `divide-y`, так как они не позволяют создать эффект "пробела".

### 2. Редактируемая таблица (Editable Table)

Этот вариант таблицы используется на страницах "Управление базой проектов" (`DatabaseManagementPage`) и "Товары" (`ProductsTab`).

-   **Интерактивность**:
    -   Вместо статичного текста, ячейки содержат стандартные поля ввода (`<input>`, кастомный `<select>`).
    -   **Изменение ширины колонок**: Пользователь может изменять ширину колонок, перетаскивая их границы в заголовке таблицы. Ширина сохраняется в `localStorage` для каждого раздела отдельно.
    -   **Режим массового выбора**: Таблица поддерживает режим, в котором в каждой строке появляется чекбокс для выбора, а над таблицей — панель для массовых действий (например, "Изменить категорию", "Изменить цену", "Удалить").
    -   **Сложные ячейки**:
        -   **`DescriptionCell`**: Ячейка с `textarea`, которая автоматически расширяется при фокусе для удобного редактирования длинных описаний и сворачивается по кнопке.
        -   **`CategorySelector`**: Кастомный селектор с поиском и группировкой, который дополнительно интегрирован с кнопкой вызова AI-помощника для подбора категории.
        -   **`ActionCell`**: Ячейка с набором кнопок ("Сохранить", "Upd фото"), чья активность зависит от состояния строки (наличия изменений).
    -   **Массовое редактирование цен**: При выборе нескольких товаров и опции "Изменить -> Цену" открывается модальное окно, где можно:
        -   Установить единую цену для всех.
        -   Округлить цены до 0, 5 или 9 в большую или меньшую сторону.
        -   Увеличить или уменьшить цены на фиксированную сумму или процент.
    -   **Массовое редактирование названий**: При выборе опции "Изменить -> Название" открывается модальное окно, где можно вставить текст в начало или конец названий, или удалить определенный фрагмент текста (с защитой от опасных действий).
    -   **Массовое редактирование описаний**: Аналогично названиям, позволяет вставлять или удалять текст в описаниях.
    -   **Массовое редактирование старой цены**: Включает все опции для обычной цены, а также добавляет возможность **вычислить старую цену на основе текущей** (например, "текущая цена + 30%").
    -   **Массовое редактирование подборки**: Позволяет выбрать одну подборку (или "Без подборки") и применить ее ко всем выделенным товарам.
-   **Обратная связь**:
    -   **Подсветка изменений**: Строка, в которую были внесены изменения (`isDirty`), подсвечивается легким фоном (`bg-amber-50`).
    -   **Подсветка выбора**: Выбранные строки в режиме массового выбора подсвечиваются фоном (`bg-indigo-100`).
-   **Реализация**: `features/database-management/components/ProjectTable.tsx`, `features/products/components/ProductsTable.tsx`.

### 3. Нередактируемая таблица (Read-only Table)

Этот вариант используется на странице "Архив" (`ArchivePage`).

-   **Структура**: Упрощенная таблица для отображения данных без элементов ввода.
-   **Интерактивность**: Содержит колонку "Действия" с кнопками-ссылками для выполнения операций над строкой (например, "Восстановить", "Удалить").

### 4. Паттерны загрузки и анимации (на примере `ProjectTable`)

Для повышения воспринимаемой производительности и улучшения пользовательского опыта таблицы используют следующий подход.

#### 4.1. Принцип загрузки: "Сначала каркас, потом данные"

Вместо отображения полноэкранного скелетона, который скрывает интерфейс, мы используем более быстрый подход:

1.  **Мгновенная отрисовка каркаса:** Сразу после перехода на страницу пользователь видит весь статический интерфейс: шапку, кнопки управления и пустую "оболочку" таблицы с заголовками (`<thead>`).
2.  **Асинхронная загрузка данных:** Одновременно в фоне отправляется запрос на получение данных (например, списка проектов).
3.  **"Наполнение" таблицы:** Как только данные получены, React эффективно обновляет только тело таблицы (`<tbody>`), заполняя его строками.

**Преимущество:** Этот метод повышает **воспринимаемую производительность**. Пользователь не ждет перед пустым экраном или скелетоном, а сразу видит структуру интерфейса и понимает, что данные сейчас появятся.

#### 4.2. Принцип анимации: "Каскадное появление"

Чтобы избежать резкого "выпрыгивания" данных, строки таблицы появляются плавно и последовательно:

1.  **Анимация строки:** Каждая строка (`<tr>`) получает CSS-класс `animate-fade-in-up`, который заставляет ее плавно появиться, двигаясь снизу вверх.
2.  **Эффект каскада:** Для каждой последующей строки устанавливается небольшая задержка анимации (`animation-delay`) в зависимости от ее порядкового номера (например, `index * 20ms`).

**Результат:** Строки появляются не все одновременно, а одна за другой, создавая элегантный каскадный эффект. Это приятно для глаз и помогает пользователю плавно воспринять появление нового контента.

### 5. Правила использования

-   **Читаемость**: Не перегружайте таблицу слишком большим количеством колонок. Используйте функцию скрытия/показа колонок для предоставления пользователю контроля над отображением.
-   **Адаптивность**: На мобильных устройствах таблицы с большим количеством колонок должны иметь горизонтальный скролл. Важные колонки (например, "Название") должны быть первыми.
-   **Доступность**: Все заголовки таблиц (`<th>`) должны иметь атрибут `scope="col"`. Интерактивные элементы внутри ячеек должны быть доступны с клавиатуры.