# Логика планирования и публикации

**Компонент:** `features/posts/components/modals/PostDateTimePicker.tsx`, `features/posts/components/modals/PostCreationOptions.tsx`
**Логика:** `features/posts/hooks/usePostForm.ts`, `useBulkCreationManager.ts`

## 1. Методы публикации
Вверху окна есть переключатель `publicationMethod`:
1.  **Запланировать (System):** Создает запись в `system_posts`. Публикуется нашим бэкендом.
2.  **В отложку VK:** Создает запись в `scheduled_posts` (реальная отложка VK).
3.  **Опубликовать сейчас:** Немедленный вызов `wall.post`.

**Авто-переключение:** Если выбран метод "Сейчас", но пользователь меняет дату на будущую, метод автоматически переключается на "Запланировать".

## 2. Массовое создание (Bulk Mode)
*   Пользователь может добавить до 10 слотов (Дата + Время).
*   При сохранении создается N отдельных постов с одинаковым контентом.
*   **Валидация:** Нельзя создать массовые посты в режиме "Опубликовать сейчас" или если включена "Циклическая публикация".

## 3. Циклическая публикация (Cyclic Posts)
Доступна только при методе публикации **"Запланировать"**.
*   **Назначение:** Создать серию постов, выходящих с определенной периодичностью.
*   **Компонент настройки:** `PostCreationOptions.tsx`.
*   **Настройки:**
    *   **Тип интервала:** Минуты, Часы, Дни, Недели, Месяцы.
    *   **Интервал:** Числовое значение (каждые N дней).
    *   **Особая логика месяцев:** 
        *   Если выбран тип "Месяцы", появляются радио-кнопки для выбора дня публикации: "Каждое N число" (берется из основной даты поста) или "В последний день месяца".
        *   **Валидация:** Если дата поста выпадает на 31 число (или 29/30), система блокирует опцию "Каждое N число" и принудительно выбирает "В последний день месяца" или предупреждает пользователя, так как не во всех месяцах есть эти дни.
*   **Ограничение цикла:**
    *   "Никогда (бесконечно)".
    *   "После N повторений": Пост будет пересоздан N раз, после чего удалится.
    *   "После даты": Цикл остановится, если следующая расчетная дата будет позже указанной.
*   **Конфликт с Bulk:** Нельзя одновременно использовать массовое создание (несколько дат) и цикличность.

## 4. Мульти-проектность
*   Позволяет выбрать несколько проектов (чекбоксы).
*   Пост будет создан в каждом выбранном проекте (и в каждом временном слоте/цикле).
*   Итоговое количество постов = `Projects * TimeSlots`.

## 5. Проверка конфликтов (Backend Side)
Фронтенд не проверяет занятость слотов. Это делает бэкенд.
*   Если время занято, бэкенд автоматически сдвигает время нового поста на +5 минут, пока не найдет свободное окно.
*   Это гарантирует, что посты не наложатся друг на друга, даже при массовом создании.