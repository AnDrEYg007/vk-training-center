# Логика Таблицы Товаров

**Компонент:** `features/products/components/ProductsTable.tsx`
**Строка:** `features/products/components/table/ProductRow.tsx`

## 1. Управление колонками (`useColumnManager`)
Логика управления шириной и видимостью колонок вынесена в отдельный хук.

*   **Хранение:** Настройки (ширина и видимость) сохраняются в `localStorage` для каждого проекта отдельно.
*   **Ресайз:** Реализован через `MouseEvent` на заголовках таблицы.
*   **Авто-видимость:** Если пользователь загружает новое фото, колонка `new_photo` автоматически становится видимой, если была скрыта.

## 2. Интерактивные ячейки

### `ActionCell.tsx` (Действия)
*   Содержит кнопки: Сохранить строку, Загрузить фото, Удалить.
*   **Логика**: Кнопка "Сохранить" активна только если для данной конкретной строки есть записи в `editedItems` или `pendingPhotos`.

### `DescriptionCell.tsx` (Описание)
*   **Авто-высота:** Использует `textarea`, который автоматически расширяется при фокусе (`scrollHeight`) и сворачивается по кнопке.
*   **AI-коррекция:** Содержит кнопку вызова AI. При получении ответа показывает компонент `DiffViewer` для сравнения старого и нового текста.

### `NewPhotoCell.tsx` (Новое фото)
*   **Универсальность:** Принимает как файл (через `ActionCell`), так и прямую ссылку (Paste URL).
*   **Валидация URL:** При вставке ссылки происходит попытка загрузки `new Image()`. Если успешно — показывается превью, если нет — ошибка.

### `AiCategoryCell.tsx` (Категория)
*   Комбинирует `CategorySelector` и кнопку вызова AI.
*   При вызове AI блокирует селектор и показывает лоадер.

## 3. Оптимизация рендеринга
*   Таблица использует `table-layout: fixed` для производительности при большом количестве строк.
*   Строки анимируются при появлении (`animate-fade-in-up`) с задержкой, зависящей от индекса, создавая эффект каскада.