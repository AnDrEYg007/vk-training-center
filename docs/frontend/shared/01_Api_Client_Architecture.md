# Архитектура API Клиента

**Файл:** `shared/utils/apiClient.ts`
**Конфигурация:** `shared/config.ts`

Этот модуль является "сердцем" сетевого взаимодействия приложения.

## 1. Функция `callApi`

Это универсальная обертка над `fetch`, которую используют все сервисы.

### Сигнатура
```typescript
export const callApi = async <T = any>(endpoint: string, payload: object = {}): Promise<T>
```

### Ключевые возможности

1.  **Автоматическая конфигурация URL:**
    *   Использует `API_BASE_URL` из `config.ts`.
    *   Динамически переключается между `localhost`, `preprod` и `prod` на основе настроек `localStorage`.

2.  **Логика повторных попыток (Retry Logic):**
    *   Реализует паттерн **Exponential Backoff**.
    *   При сетевых ошибках или ошибках 5xx (Server Error) делает до 5 попыток с нарастающей задержкой (1s, 2s, 4s...).
    *   **Исключение:** Ошибки клиента (4xx, например 404 или 403) пробрасываются сразу, так как повтор запроса не исправит проблему.

3.  **Унифицированная обработка ошибок:**
    *   Парсит ответы от FastAPI, включая ошибки валидации Pydantic (`detail`).
    *   Выбрасывает типизированную ошибку `HttpError` или `Error` с понятным сообщением.
    *   В случае критического сбоя (все попытки исчерпаны) показывает `alert` с инструкцией по диагностике (проверка запуска бэкенда).

## 2. Интерпретация ошибок (`services/errorService.ts`)

Для улучшения UX ошибки, пойманные в компонентах, передаются в функцию `interpretApiError`.

*   **Задача:** Преобразовать технический текст ошибки в понятное действие для UI.
*   **Пример:** Если текст ошибки содержит "Access denied", функция возвращает тип `PERMISSION_ERROR`. Компонент видит этот тип и показывает пользователю красивый баннер с инструкцией проверить права токена, вместо того чтобы выводить сырой лог ошибки.