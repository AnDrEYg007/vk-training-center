# Управление Пользователями и Системой

**Компонент:** `features/users/components/UserManagementPage.tsx`
**Роль:** Доступно только пользователям с ролью `admin`.

Этот раздел является "Пультом управления" администратора. Он состоит из четырех вкладок, каждая из которых отвечает за свой аспект администрирования.

## 1. Вкладка "Пользователи"

Классический CRUD-интерфейс для управления учетными записями людей, которые имеют доступ к приложению.

*   **Интерфейс:** Редактируемая таблица (`UserTable`).
*   **Функции:**
    *   **Инлайн-редактирование:** Данные (ФИО, Логин, Пароль) меняются прямо в ячейках.
    *   **Добавление:** Создание новой строки с временным ID.
    *   **Удаление:** Пометка на удаление.
    *   **Массовое сохранение:** Изменения отправляются на сервер пакетом (`/api/users/updateAll`) только при нажатии кнопки "Сохранить".

## 2. Вкладка "Системные страницы" (`SystemAccountsTab`)

Здесь происходит управление "Пулом токенов" — аккаунтами ВКонтакте, которые система использует для парсинга данных и обхода лимитов.

*   **Компоненты:** `AccountsTable`, `AccountsHeader`, `AddSystemAccountsModal`, `AuthorizeAccountModal`.
*   **Ключевой функционал:**
    *   **Добавление списком:** Модальное окно принимает список ссылок на профили VK. Бэкенд автоматически парсит их, получает ID и Аватарки через API (используя текущий рабочий токен) и сохраняет в БД.
    *   **Проверка токенов:** Кнопка "Проверка токенов" запускает массовую валидацию. Система проверяет каждый токен (`/api/system-accounts/verifyToken`), обновляет его статус (`active`/`error`) и отображает лоадеры напротив каждого аккаунта.
    *   **Авторизация (Получение токена):**
        1.  Кнопка "Авторизовать" открывает модальное окно `AuthorizeAccountModal`.
        2.  Пользователь выбирает приложение (Android, VK Me, Kate Mobile) и переходит по ссылке OAuth.
        3.  Полученную ссылку из адресной строки (содержащую `access_token`) пользователь вставляет в поле ввода.
        4.  Система парсит токен и проверяет, принадлежит ли он именно этому пользователю.
    *   **ENV Token:** В списке всегда отображается специальный аккаунт "ENV TOKEN". Это токен из файла `.env`, который нельзя удалить, но можно проверить его статус и статистику.

## 3. Вкладка "Логи токенов" (`TokenLogsDashboard`)

Инструмент для аудита и отладки работы системы ротации токенов.

*   **Визуализация:**
    *   **График:** Интерактивный график (`TokenUsageChart`), показывающий активность токенов во времени (за час/день/неделю). Можно фильтровать по типам запросов (Всего/Успех/Ошибки).
    *   **Сводка:** Карточки с общим количеством запросов, успехов и ошибок.
    *   **Топы:** Списки "Топ успешных методов" и "Топ ошибок" для выявления проблемных мест.
*   **Таблица логов:** Детальный список всех запросов к VK API.
    *   **Фильтры:** По конкретному аккаунту, поиск по названию метода (`wall.get`) или тексту ошибки.
    *   **Данные:** Дата, Метод, Статус, Проект, Детали ошибки.
*   **Очистка:** Возможность очистить логи (полностью или для конкретного аккаунта), чтобы освободить место в БД.

## 4. Вкладка "Активные задачи" (`ActiveTasksTab`)

Монитор фоновых процессов сервера (Task Monitor).

*   **Назначение:** Позволяет администратору видеть, какие тяжелые процессы (синхронизация подписчиков, обновление истории) выполняются в данный момент.
*   **Функционал:**
    *   **Автообновление:** Список задач обновляется каждые 3 секунды.
    *   **Индикация:** Показывает тип задачи, проект, прогресс-бар и статус (`fetching`, `processing`).
    *   **Сброс:** Кнопка "Сброс" позволяет принудительно удалить "зависшую" задачу из памяти сервера (из БД задач), разблокируя возможность запуска новых процессов для этого проекта.