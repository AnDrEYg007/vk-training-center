# Модальное окно поста: Логика и Состояния

**Компонент:** `features/posts/components/modals/PostDetailsModal.tsx`
**Хук:** `features/posts/hooks/usePostDetails.ts`
**Хук формы:** `features/posts/hooks/usePostForm.ts`

## 1. Режимы работы (`mode`)

Модальное окно может находиться в одном из трех состояний:

1.  **`view` (Просмотр)**:
    *   Открывается при клике на пост.
    *   Все поля `readOnly`.
    *   Кнопки сохранения скрыты.
    *   Есть кнопка "Редактировать" -> переводит в режим `edit`.
2.  **`edit` (Редактирование)**:
    *   Открывается при создании нового поста или нажатии "Редактировать".
    *   Поля доступны для изменения.
    *   Активна логика "Dirty Check".
3.  **`copy` (Копирование)**:
    *   Открывается при нажатии "Копировать".
    *   Данные берутся из исходного поста, но ID генерируется новый (`new-post-...`).
    *   Дата автоматически сбрасывается на "Завтра 10:00", если исходная дата в прошлом.

## 2. "Грязное" состояние (`useDirtyCheck`)

Хук `useDirtyCheck` сравнивает текущее состояние формы с исходным объектом `post`.
*   **Сравниваются:** Текст, список ID изображений (порядок не важен), список вложений, дата/время, выбранные проекты (в мульти-режиме).
*   **Влияние:** Если `isDirty === false`, кнопка "Сохранить" неактивна (кроме создания нового поста).
*   **Защита:** При попытке закрыть окно с `isDirty === true`, появляется `ConfirmUnsavedChangesModal`.

## 3. Безопасное закрытие

Логика в `handleClose` проверяет не только `isDirty`, но и **состояние UI**:
*   Если открыта панель **AI-помощника**.
*   Если открыта панель **Переменных**.

Если что-то из этого открыто, пользователь также получит предупреждение перед закрытием, чтобы не потерять контекст работы с AI или настройки.

## 4. Блокировка UI
Во время сохранения (`isSaving`) или загрузки медиа (`isUploading`):
*   Кнопки "Сохранить" и "Удалить" блокируются.
*   Поля ввода блокируются.
*   Кнопка закрытия окна блокируется (или игнорируется).