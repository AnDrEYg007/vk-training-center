# Управление медиафайлами (PostMediaSection)

**Компонент:** `features/posts/components/modals/PostMediaSection.tsx`

Этот компонент полностью инкапсулирует сложную логику работы с изображениями и вложениями.

## 1. Источники изображений

1.  **Локальная загрузка (`<input type="file">`):**
    *   Файлы загружаются на бэкенд (`/api/media/uploadPhoto`) сразу после выбора.
    *   На время загрузки отображается плейсхолдер с лоадером (`UploadingGridItem`).
    *   Родительский компонент получает уведомление `onUploadStateChange(true)`, блокируя кнопку "Сохранить".
2.  **Галерея (`ImageGallery`):**
    *   Позволяет выбрать фото из альбомов VK.
    *   При выборе фото добавляются в массив `editedImages` как объекты `{id: 'photoX_Y', url: '...'}`.
3.  **Drag-and-Drop:**
    *   Зона дропа — весь компонент `PostMediaSection`.
    *   При перетаскивании файлов появляется оверлей.
    *   После дропа открывается `UploadConfirmationModal` для подтверждения загрузки.

## 2. Отображение

*   **Сетка:** Изображения выстраиваются в адаптивную сетку.
*   **Предпросмотр:**
    *   **Клик:** Открывает `ImagePreviewModal` (полноэкранный, через портал).
    *   **Hover:** При наведении на миниатюру появляется увеличенное всплывающее превью (`HoverPreview`, реализовано через портал), которое следует за курсором или фиксируется рядом.

## 3. Стабильность данных

Компонент является **управляемым (controlled)**. Он не хранит массив изображений внутри себя, а принимает `editedImages` и `onImagesChange` от родителя. Это гарантирует, что при сохранении поста будут отправлены именно те картинки, которые видит пользователь, исключая рассинхронизацию.