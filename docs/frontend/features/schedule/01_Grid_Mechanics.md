# Механика сетки календаря

**Компонент:** `features/schedule/components/ScheduleGrid.tsx`
**Колонка:** `features/schedule/components/DayColumn.tsx`

## 1. Структура и Адаптивность
Сетка построена на CSS Grid.
*   **Mobile:** 1 колонка (`grid-cols-1`)
*   **Tablet Portrait:** 2 колонки (`sm:grid-cols-2`)
*   **Tablet Landscape:** 4 колонки (`md:grid-cols-4`)
*   **Desktop:** 7 колонок (`lg:grid-cols-7`)

## 2. Рендеринг данных и "Призраки"
*   Сетка получает плоский список `posts` и `notes`.
*   **UnifiedPost:** Типы `ScheduledPost` и `SystemPost` объединены.
*   **Client-Side Projection (Призрачные посты):**
    *   Компонент использует `useMemo` для вычисления `postsWithGhosts`.
    *   Он находит все активные циклические системные посты (`is_cyclic: true`) и проецирует их будущие появления на текущую отображаемую неделю.
    *   Расчет происходит с учетом интервала, типа повторения и ограничений (дата/кол-во).
    *   Эти виртуальные посты получают флаг `isGhost: true` и `originalId` родителя.
    *   **Вид:** Призраки отображаются полупрозрачными (`opacity-60`) и имеют особый стиль в `PostCard` (серый фон, синяя рамка).
    *   **Взаимодействие:** 
        *   Клик по призраку открывает на редактирование его **родительский** пост (`originalId`).
        *   Drag-and-Drop для призраков **заблокирован**.

## 3. Фильтрация и Сортировка
*   В каждой ячейке дня происходит фильтрация общего массива (включая призраков):
    ```typescript
    const dayPosts = postsWithGhosts.filter(p => isSameDay(p.date, colDate));
    ```
*   Внутри дня элементы сортируются по времени.

## 4. Видимость и Фильтры
*   **Заметки:** Могут быть в состоянии `expanded` (полный текст), `collapsed` (только заголовок) или `hidden` (скрыты).
*   **Теги:** Видимость тегов на карточках постов переключается глобально.

## 5. Оптимизация
*   Компонент `ScheduleGrid` обернут в `React.memo`.
*   Используются стабильные ключи (`key={post.id}`).
*   Дочерние компоненты (`PostCard`, `NoteCard`) мемоизированы для предотвращения перерисовки всей сетки.