# Настройки Проекта

**Компонент:** `features/projects/components/modals/ProjectSettingsModal.tsx`
**Хук:** `features/projects/hooks/useProjectSettingsManager.ts`

## 1. Архитектура управления состоянием

Хук `useProjectSettingsManager` полностью изолирует логику модального окна. Он загружает данные при открытии и сохраняет их при закрытии.

### Загрузка данных
При монтировании компонента хук делает параллельные запросы к API:
*   `getProjectDetails` (основные поля)
*   `getTags` (теги)
*   `getAiPresets` (шаблоны AI)
*   `getGlobalVariablesForProject` (глобальные переменные)

### Сохранение (`handleSubmit`)
Сохранение происходит атомарно для пользователя, но внутри это серия асинхронных запросов, обернутых в `Promise.all`:
1.  Сохранение/Удаление тегов.
2.  Сохранение/Удаление шаблонов AI.
3.  Обновление определений и значений глобальных переменных.
4.  Обновление основных полей проекта (`updateProjectSettings`).

## 2. Редакторы (Sub-components)

Модальное окно использует паттерн "Аккордеон" для группировки настроек. Внутри секций используются специализированные редакторы:

### `VariablesEditor` (Локальные переменные)
*   Позволяет создавать пары "Имя - Значение".
*   **Умная настройка:** Кнопка вызывает AI (`api.runAiVariableSetup`), который анализирует сообщество VK и пытается автоматически заполнить пустые поля (например, найти телефон или адрес в описании группы).

### `GlobalVariablesEditor`
*   **Двухуровневое редактирование:** Позволяет редактировать не только *значения* для текущего проекта, но и сами *определения* глобальных переменных (название, ключ).
*   **Валидация:** Содержит логику проверки уникальности имен и ключей "на лету" (подсветка красным).

### `TagsEditor`
*   Управление списком тегов для авто-тегирования постов.
*   Использует `ColorPickerDropdown` (через портал) для выбора цвета тега.

### `AiPromptPresetsEditor`
*   CRUD-интерфейс для шаблонов системных инструкций AI.

## 3. Управление командами
В секции "Команда" реализован гибридный UI:
*   Список существующих команд (кнопки).
*   Кнопка "+ Создать команду", которая превращается в инлайн-поле ввода. Новая команда сразу выбирается и добавляется в глобальный список `uniqueTeams`.