
# Обзор и Архитектура (System Lists)

**Компонент:** `features/lists/components/SystemListsTab.tsx`
**Основной хук:** `features/lists/hooks/useSystemListsManager.ts`

## 1. Концепция
Модуль "Системные списки" предоставляет интерфейс для работы с локальной базой данных пользователей и контента проекта. В отличие от онлайн-запросов к VK, этот модуль работает с кешированными и агрегированными данными, что позволяет строить аналитику и историю изменений.

## 2. Структура интерфейса (Компонентная архитектура)

Главный компонент `SystemListsTab` выступает в роли "умного контейнера". Он управляет состоянием через хук `useSystemListsManager`, но не рендерит UI напрямую. Вместо этого он делегирует отображение трем специализированным секциям:

1.  **`ListsNavigation` (Навигация):**
    *   Отвечает за переключение групп (Подписчики, Активности) и конкретных списков.
    *   Рендерит карусель карточек `ListCard`.
    *   Управляет логикой "активной вкладки" и отображением статусов обновления на карточках.
2.  **`ListsFilters` (Фильтрация и Управление):**
    *   Содержит поле поиска и все выпадающие списки фильтров (`FilterDropdown`).
    *   Содержит кнопки глобальных действий для текущего списка: "Анализ" (для рассылки), "Обновить детали", "Очистить базу".
    *   Реализует паттерн `Sticky Header`, прилипая к верху экрана при скролле.
3.  **`ListsDataView` (Отображение данных):**
    *   Отвечает за выбор правильной таблицы (`MembersTable`, `PostsTable` или `InteractionTable`) в зависимости от типа списка.
    *   Отображает лоадеры во время первичной загрузки или пагинации.

## 3. Логические группы (Tabs)

Интерфейс разделен на логические группы, переключаемые кнопками в шапке `ListsNavigation`:

1.  **Подписчики**:
    *   **Подписчики:** Текущая база участников сообщества.
    *   **В рассылке (Mailing):** Пользователи, у которых есть активный диалог с сообществом.
    *   **Вступившие / Вышедшие (История):** Хронология изменений состава.
2.  **Активности**:
    *   **Лайкали, Комментировали, Репостили:** Списки пользователей с агрегированной статистикой действий.
3.  **Автоматизации (Конкурсы):**
    *   Списки участников и победителей конкурсов (если активен модуль).
4.  **Прочее**:
    *   **Посты (История):** База всех постов со статистикой.
    *   **Авторы постов:** Список уникальных авторов, публиковавших контент.

## 4. Архитектура управления состоянием (`useSystemListsManager`)

Управление состоянием вынесено в композитный хук-фасад `useSystemListsManager`. Он объединяет:

*   **`useListState`**: Хранит состояние UI (активный список, фильтры, пагинация) и данные.
*   **`useListFetching`**: Отвечает за "синхронную" загрузку данных (GET запросы) для таблиц и статистики.
*   **`useListPolling`**: Управляет длительными фоновыми задачами обновления (Task Monitor).

## 5. Компонент `ListCard`

Карточка списка — это интерактивный элемент навигации.

*   **Отображение:** Показывает название, иконку и **основную цифру** (количество записей).
*   **Двойной счетчик (для постов):** Если в базе меньше постов, чем в VK, отображается "1000 из 5400".
*   **Обновление:** Содержит кнопку обновления. Для постов реализовано **гранулярное обновление** через выпадающее меню ("Обновить 1000" / "Обновить всё").
*   **Индикация прогресса:** Во время выполнения фоновой задачи отображается спиннер и текстовый статус (например, "Загрузка 4500/10000").
