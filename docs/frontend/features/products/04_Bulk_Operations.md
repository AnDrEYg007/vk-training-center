# Массовые операции с товарами

**Хук:** `features/products/hooks/useProductBulkActions.ts`
**Компоненты:** `features/products/components/modals/Bulk*Modal.tsx`

## 1. Активация и выбор

1.  Пользователь нажимает "Выбрать" в хедере. Активируется `isSelectionMode`.
2.  Появляются чекбоксы (`CheckboxCell`) в таблице.
3.  При выборе > 0 товаров в хедере появляется панель действий: "Изменить" и "Удалить".

## 2. Меню "Изменить" (`BulkEditPopover`)

При нажатии на "Изменить" открывается Popover (через портал) со списком доступных полей:
*   Название
*   Описание
*   Подборку
*   Цену
*   Старую цену
*   Категорию

Выбор пункта открывает соответствующее модальное окно.

## 3. Логика модальных окон

### Изменение цены (`BulkPriceEditModal`)
Поддерживает 3 режима работы:
1.  **Установить:** Присвоить всем жесткое значение (в рублях).
2.  **Округлить:** Округлить текущую цену до 0, 5 или 9 в большую или меньшую сторону.
    *   *Пример:* 123 -> 129, 123 -> 120.
3.  **Изменить на:** Математическая операция (+/-) в рублях или процентах.
    *   *Пример:* Поднять на 10%, Снизить на 100р.

### Изменение текста (`BulkTitleEditModal`, `BulkDescriptionEditModal`)
Поддерживает ручной и AI режимы.

**Ручной режим:**
*   **Вставить:** Добавить текст в начало или конец текущего значения.
*   **Удалить:** Найти и вырезать указанную подстроку.
    *   *Защита:* Если удаляемый текст короче 3 символов, требуется дополнительное подтверждение (защита от случайного удаления букв "а", "и" и т.д.).

**AI режим:**
*   См. документ `03_AI_Features.md`.

### Изменение категории
Поддерживает выбор вручную (через `CategorySelector`) или массовый подбор через AI.

## 4. Массовое удаление

1.  Нажатие "Удалить" открывает `ConfirmationModal`.
2.  При подтверждении вызывается `api.deleteMarketItems`.
3.  **Важно:** API удаляет товары из VK и из локальной БД, а также **декрементирует** счетчики в связанных подборках (`MarketAlbum`), чтобы цифры в UI оставались актуальными без полной перезагрузки.