# AI-функции в Товарах

**Хук:** `features/products/hooks/useProductAI.ts`
**Сервис:** `backend_python/services/market_ai_service.py`

## 1. Подбор категории (Suggest Category)

### Одиночный режим
1.  Пользователь нажимает лампочку в ячейке категории.
2.  Фронтенд отправляет `title` и `description` на `/api/market/ai/suggestCategory`.
3.  **Бэкенд (Двухэтапный процесс)**:
    *   **Шаг 1:** AI выбирает 2-3 подходящие *родительские секции* из списка всех секций VK.
    *   **Шаг 2:** AI выбирает *финальную подкатегорию* только из списка категорий выбранных секций.
    *   *Зачем:* Список категорий VK огромен, он не помещается в контекст одного промпта.
4.  Результат возвращается на фронтенд, открывается модальное окно подтверждения `AiCategorySuggestionModal`.

### Массовый режим
1.  Пользователь выбирает товары -> Изменить -> Категорию -> AI-помощник.
2.  Фронтенд отправляет массив `{id, title, description}`.
3.  **Бэкенд**:
    *   Формирует единый промпт с JSON-списком товаров.
    *   Просит AI вернуть JSON-объект `{itemId: categoryId}`.
    *   Использует fallback (поштучный перебор), если AI вернул невалидный JSON.
4.  Результат отображается в таблице внутри `BulkCategoryEditModal`.

## 2. Коррекция текста (Описание и Название)

### Логика
1.  **Задача:** Исправить орфографию, пунктуацию, улучшить читаемость.
2.  **Промпт:** "Ты — редактор текстов... Верни только JSON объект {id: исправленный_текст}".
3.  **Визуализация:** Используется компонент `DiffViewer`, который подсвечивает удаления красным, а добавления зеленым (алгоритм LCS).

### Компоненты
*   `BulkDescriptionEditModal`: Имеет три состояния view (`manual`, `loading`, `results`). В режиме `results` рендерит список изменений с чекбоксами для выборочного применения.