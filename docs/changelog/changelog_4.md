# Журнал изменений (Changelog) - Часть 3

Этот файл содержит историю версий и описание основных изменений в приложении "VK Content Helper", начиная с версии 1.33.0.

## Версия 1.65.0 - 2024-08-04

-   **Улучшение UX: Валидация данных в разделе "Товары"**
    -   **Что внедрено:** Добавлена строгая проверка корректности данных перед сохранением товаров, чтобы предотвратить отправку некорректной информации в VK.
    -   **Как работает:**
        1.  **Правила:** Название (мин. 4 символа), Описание (мин. 10 символов), Цена (число > 0), Категория (обязательна).
        2.  **В таблице товаров:** При попытке сохранить товар (индивидуально или массово) с некорректными данными, операция прерывается. Поля с ошибками подсвечиваются красной рамкой, снизу появляется поясняющий текст.
        3.  **В обновлении из файла:** При загрузке изменений из Excel/CSV, данные также проходят проверку. Ошибочные ячейки подсвечиваются в окне предпросмотра, и применение изменений блокируется до их исправления.
    -   **Что дает пользователям:** Защищает от случайных ошибок (например, стирание описания или цены) и гарантирует, что в магазин попадают только корректно заполненные карточки.

## Версия 1.64.0 - 2024-08-04

-   **Новый функционал: Полнофункциональный раздел "Товары"**
    -   **Что внедрено:** В модуль "Контент-менеджмент" добавлена новая вкладка "Товары", предоставляющая комплексный интерфейс для управления товарами VK Market.
    -   **Как это работает:**
        1.  **Просмотр и фильтрация:** На вкладке отображается редактируемая таблица со всеми товарами проекта. Пользователи могут фильтровать товары по подборкам (альбомам).
        2.  **Инлайн-редактирование:** Все ключевые поля товара (название, описание, цена, артикул, категория, подборка) можно редактировать прямо в таблице. Измененные строки подсвечиваются для наглядности.
        3.  **Управление изображениями:** Пользователи могут загружать новые главные фото для товаров, а также просматривать текущие.
        4.  **AI-помощник для категорий:** Рядом с полем "Категория" появилась кнопка-иконка "AI", которая анализирует название и описание товара и автоматически предлагает наиболее подходящую категорию из глобального списка VK.
        5.  **Массовые операции:** Включив режим "Выбрать", можно выделить несколько товаров и применить к ним массовые действия, такие как изменение категории (вручную или с помощью AI) или удаление.
        6.  **Настраиваемый интерфейс:** Пользователи могут настраивать видимость и ширину колонок в таблице, и эти настройки сохраняются для каждого проекта индивидуально.
    -   **Что дает пользователям:** Предоставляет мощный и удобный инструмент для централизованного управления каталогом товаров, значительно ускоряя рутинные операции и повышая эффективность благодаря интеграции с AI.

## Версия 1.63.0 - 2024-08-04

-   **Улучшение UX: Обновлен интерфейс AI-помощника**
    -   **Что сделано:** Переработан интерфейс взаимодействия с результатами генерации в чате AI-помощника для повышения скорости и удобства работы.
    -   **Как работает сейчас:**
        1.  **Кнопки-иконки:** Текстовые кнопки "Копировать" и "Добавить в текст поста" заменены на стандартные, интуитивно понятные иконки.
        2.  **Новая функция "Сгенерировать заново":** Добавлена новая кнопка-иконка "Обновить" (две стрелки по кругу). При нажатии на нее, система повторно отправит тот же самый запрос с той же системной инструкцией, которые использовались для генерации этого ответа. В истории чата появится новый блок с новым результатом.
    -   **Что дает пользователям:** Упрощает и ускоряет взаимодействие с AI. Новая функция "Сгенерировать заново" позволяет быстро получать альтернативные варианты текста, не вводя запрос повторно.

## Версия 1.62.0 - 2024-08-04

-   **Улучшение UX: Постоянное отображение кнопок действий на карточках**
    -   **Что сделано:** Кнопки действий (редактировать, удалить, копировать) на карточках постов (`PostCard`) и заметок (`NoteCard`) теперь **видны всегда**, а не только при наведении курсора.
    -   **Как работает сейчас:** Это изменение устраняет необходимость "охотиться" за кнопками и делает интерфейс более предсказуемым и интуитивно понятным, особенно для новых пользователей. Взаимодействие с карточками стало быстрее и очевиднее.
    -   **Техническая деталь:** В компоненте `NoteCard` были убраны классы `opacity-0` и `group-hover:opacity-100`. В документации для `PostCard` было исправлено описание, которое ошибочно указывало на появление кнопок при наведении, хотя они уже были всегда видимы.

## Версия 1.61.0 - 2024-08-04

-   **Улучшение UX: Валидация уникальности глобальных переменных**
    -   **Что внедрено:** Добавлена система валидации "на лету", которая предотвращает создание глобальных переменных с одинаковыми названиями или ключами плейсхолдеров.
    -   **Как работает сейчас:** При попытке ввести дублирующееся имя или ключ, поле ввода подсвечивается красной рамкой, а под ним появляется сообщение об ошибке (например, "Это название уже используется"). Кнопка "Сохранить" становится неактивной до тех пор, пока все ошибки не будут устранены. Эта проверка работает как на странице "Управление глобальными переменными", так и в модальном окне настроек проекта.
    -   **Что дает пользователям:** Полностью исключает возможность случайного создания дубликатов, что могло приводить к ошибкам на сервере и путанице. Интерфейс стал более предсказуемым и защищенным от ошибок.

## Версия 1.60.0 - 2024-08-04

-   **Новый функционал: Полноценное управление глобальными переменными в настройках проекта**
    -   **Что внедрено:** Раздел "Глобальные переменные" в настройках проекта был полностью переработан, став таким же функциональным, как и редактор переменных проекта.
    -   **Как работает сейчас:** Вместо статического списка полей для значений, теперь это полноценный редактор. Пользователи могут не только вводить значения, но и **создавать, редактировать и удалять сами определения** глобальных переменных (их Название и Ключ плейсхолдера) прямо из этого окна, без необходимости переходить в раздел "Управление базой проектов".
    -   **Что дает пользователям:** Значительно упрощает и ускоряет управление глобальными переменными, делая процесс более интуитивным и интегрированным в основной рабочий процесс.

## Версия 1.59.0 - 2024-08-04

-   **Новый функционал: Внедрение системы глобальных переменных**
    -   **Что внедрено:** Реализована двухуровневая система переменных. Теперь администраторы могут создавать "глобальные" типы переменных (например, "Адрес", "Телефон"), а пользователи — задавать их конкретные значения для каждого проекта.
    -   **Как это работает:**
        1.  **Управление определениями (для администраторов):** В разделе "Управление базой проектов" появилась новая вкладка "Глобальные переменные". Здесь администратор может создавать и редактировать "типы" переменных: их название (например, "Адрес доставки") и ключ-плейсхолдер (например, `delivery_adress`).
        2.  **Управление значениями (для пользователей):** В настройках каждого проекта появился новый раздел "Глобальные переменные", где отображаются все созданные администратором определения. Пользователь может вписать в них значения, уникальные для этого проекта (например, "ул. Ленина, 1").
        3.  **Использование в постах:** В модальном окне поста, в панели "Переменные", появился новый блок "Глобальные переменные". При клике на кнопку (например, "Адрес доставки") в текст поста вставляется плейсхолдер (например, `{global_delivery_adress}`).
        4.  **Автоматическая подстановка:** При публикации поста (как системного, так и в отложку VK) бэкенд автоматически находит все плейсхолдеры и заменяет их на значения, указанные в настройках конкретного проекта. Если значение для проекта не задано, плейсхолдер заменяется на пустую строку.
        5.  **Предпросмотр в календаре:** Для **системных постов** в календаре теперь сразу отображается текст с подставленными значениями, что позволяет визуально контролировать результат еще до публикации.
    -   **Что дает пользователям:** Эта система кардинально упрощает управление повторяющейся информацией. Достаточно один раз настроить значения для проекта, и они будут автоматически подставляться во все посты, что экономит время и исключает ошибки при копировании данных вручную.

## Версия 1.58.0 - 2024-08-03

- **Улучшение UX: Защита от случайного закрытия модального окна поста**
  - **Что сделано:** Усовершенствована логика закрытия модального окна создания/редактирования поста.
  - **Как работает сейчас:** Теперь, если пользователь кликнет вне области модального окна, система проверит не только наличие несохраненных изменений, но и то, открыты ли в данный момент панели "AI-помощник" или "Переменные". Если хотя бы одно из этих условий выполняется, появится стандартное диалоговое окно с вопросом "Вы уверены, что хотите закрыть окно без сохранения?".
  - **Что дает пользователям:** Это важное улучшение защищает пользователя от случайной потери работы. Теперь, если вы потратили время на настройку AI-инструкции или поиск нужных переменных, случайный клик "мимо" окна не приведет к потере этих данных.

## Версия 1.57.0 - 2024-08-03

- **Архитектурное улучшение: Рефакторинг и оптимизация карточки поста (`PostCard`)**
  - **Что сделано:** Проведен глубокий рефакторинг компонента `PostCard` для улучшения его структуры, производительности и устранения бага с "морганием" изображений.
  - **Как работает сейчас:**
    1.  **Выделение логики в хук:** Вся сложная логика по определению доступных действий и их адаптивному распределению вынесена в новый кастомный хук `usePostCardActions`.
    2.  **Декомпозиция на дочерние компоненты:** Все визуальные блоки (`ImageGrid`, `AttachmentsDisplay`, `PostTags`) были вынесены в отдельные, мемоизированные дочерние компоненты.
  - **Что это дает:**
    -   **Устранение "моргания":** Этот рефакторинг полностью решает проблему, при которой изображения "моргали" при изменении состояния родительского компонента (например, при переключении видимости тегов). Теперь дочерние компоненты являются "стабильными", и React может их корректно обновлять, а не перемонтировать.
    -   **Чистота кода:** Основной компонент `PostCard` стал значительно чище и проще для понимания, так как он теперь в основном отвечает за разметку, а не за сложную логику.

## Версия 1.56.0 - 2024-08-03

- **Исправление: Устранена ошибка типизации в хуке `usePostCardActions`**
  - **Что исправлено:** Устранена ошибка TypeScript, возникавшая из-за использования JSX-синтаксиса в `.ts` файле.
  - **Как работает сейчас:** Вместо прямого написания JSX-тегов для иконок, теперь используется вызов `React.createElement`, что является синтаксически корректным для `.ts` файлов, не настроенных для компиляции TSX.
  - **Что дает:** Обеспечивает корректную компиляцию проекта и устраняет ошибки в среде разработки, не влияя на конечный функционал.

## Версия 1.55.0 - 2024-08-03

- **Архитектурное улучшение: Рефакторинг и модульность API-сервисов**
  - **Что сделано:** Проведен крупный рефакторинг файла `services/api.ts`. Вся логика была разделена по доменным областям (проекты, посты, AI, медиа, аутентификация и т.д.) и вынесена в отдельные, сфокусированные файлы в новую директорию `services/api/`.
  - **Как работает сейчас:** Исходный файл `services/api.ts` теперь выполняет роль "хаба" — он просто импортирует и ре-экспортирует функции из новых модульных файлов. Это сохраняет полную обратную совместимость для остального приложения, так как все импорты по-прежнему могут указывать на `services/api`.
  - **Что дает:** Этот рефакторинг не меняет функциональность, но делает архитектуру фронтенда значительно чище, более читаемой и простой для дальнейшей поддержки и расширения.

## Версия 1.54.0 - 2024-08-03

- **Улучшение UX: Контекстные ответы в AI-помощнике**
  - **Что сделано:** Реализована функция "ответить на сообщение" в чате AI-помощника. При двойном клике на сообщении AI или при ответе на него, в запросе пользователя теперь отображается кликабельная цитата исходного сообщения.
  - **Как работает сейчас:** Клик по этой цитате плавно прокручивает историю чата к оригинальному сообщению и подсвечивает его, позволяя легко восстановить контекст диалога. Для улучшения логической структуры, блок с цитатой теперь располагается внизу "пузыря" с запросом пользователя.
  - **Что дает пользователям:** Превращает историю чата из простого списка в связанный диалог. Это значительно улучшает навигацию и понимание контекста при выполнении многошаговых задач с AI.

## Версия 1.53.0 - 2024-08-03

- **Улучшение UX: Исправлено наложение элементов в AI-помощнике**
  - **Что сделано:** Устранена проблема, при которой изменяемое по высоте поле "Результат генерации" могло "прятаться" под нижние элементы интерфейса (поле ввода текста, блок загрузки изображений), если его слишком сильно растянуть. Также стилизована полоса прокрутки для соответствия общему дизайну.
  - **Как работает сейчас:** Максимальная высота контейнера AI-помощника была увеличена. Теперь при изменении размера поля оно корректно сдвигает весь последующий контент вниз, а не "проваливается" под него.
  - **Что дает пользователям:** Более стабильный и предсказуемый интерфейс при работе с AI-генератором. Устранено визуальное несоответствие и улучшено общее впечатление от работы с компонентом.

## Версия 1.52.0 - 2024-08-02

- **Новый функционал: "Умная" сортировка и автонумерация в управлении проектами**
  - **Что внедрено:** На страницу "Управление базой проектов" добавлены две функции для упрощения сортировки:
    1.  **Автоматический сдвиг:** При изменении порядкового номера (`№`) одного проекта, все затронутые проекты теперь автоматически сдвигаются вверх или вниз, чтобы освободить место и избежать дубликатов. Это имитирует перемещение элемента в списке.
    2.  **Автонумерация (кнопка "Auto №"):** Новая кнопка, которая находит максимальный существующий номер и последовательно заполняет все пустые поля `№`, начиная со следующего числа.
  - **Что дает пользователям:** Значительно ускоряет и упрощает процесс ручной и автоматической сортировки проектов, делая его более интуитивным и защищенным от ошибок.

## Версия 1.51.0 - 2024-08-02

-   **Исправление: Устранен критический баг с отображением выпадающего меню "Ещё"**
    -   **Что исправлено:** Устранена проблема с "контекстом наложения" (stacking context), из-за которой выпадающее меню в карточке поста (`PostCard`) могло отображаться под другими элементами интерфейса (например, под следующей карточкой поста).
    -   **Как работает сейчас:** Компонент `ActionsDropdown` был полностью переработан с использованием **React Portal (`createPortal`)**. Теперь выпадающее меню рендерится не внутри карточки, а напрямую в `document.body`. Это выносит его из "ловушки" родительского `z-index` и гарантирует, что оно всегда будет отображаться поверх всех остальных элементов. Также добавлена логика для динамического позиционирования меню относительно его кнопки-триггера.
    -   **Что дает пользователям:** Полностью предсказуемое и корректное поведение интерфейса. Меню "Ещё" теперь всегда доступно и не перекрывается другими элементами, что устраняет путаницу и повышает удобство использования.

## Версия 1.41.0 - 2024-08-02

-   **Новый функционал: Развертывание (деплой) бэкенда и динамическое переключение окружений**
    -   **Что внедрено:** Произведено полное развертывание бэкенда и базы данных в облачной инфраструктуре Yandex.Cloud. Фронтенд-приложение теперь может легко переключаться между "боевым" (продакшен) и локальным окружением.
    -   **Как это работает (Бэкенд):**
        1.  **Контейнеризация:** Бэкенд на Python упакован в Docker-образ и развернут как **Yandex Cloud Container**.
        2.  **База данных:** Вместо локальной SQLite, "боевой" бэкенд теперь использует управляемую базу данных **Yandex Managed Service for PostgreSQL** для повышения надежности и масштабируемости.
        3.  **Динамическая конфигурация БД:** Бэкенд автоматически определяет, какую базу данных использовать, на основе переменной окружения `DATABASE_URL`.
    -   **Как это работает (Фронтенд):**
        1.  **Переключатель окружений:** В шапку сайдбара добавлена иконка "шестеренки" ⚙️, которая открывает модальное окно "Настройки разработки".
        2.  **Выбор сервера:** В этом окне пользователь может выбрать, какой бэкенд-сервер использовать: "Продакшен (Yandex.Cloud)" или "Локальный сервер".
        3.  **Сохранение выбора:** Выбор сохраняется в `localStorage` браузера и применяется после автоматической перезагрузки страницы.
    -   **Что дает пользователям и разработчикам:**
        -   **Доступность:** Приложение теперь доступно из любой точки мира, а не только локально.
        -   **Удобство разработки:** Устранен самый большой барьер — необходимость вручную менять URL API в коде. Теперь переключение между локальной разработкой и тестированием на "боевом" сервере занимает два клика.
        -   **Надежность:** Использование управляемой СУБД PostgreSQL в продакшене значительно повышает надежность хранения данных.

## Версия 1.40.0 - 2024-08-02

-   **Новый функционал: Полноценная система авторизации и управления пользователями**
    -   **Что внедрено:** Реализована комплексная система аутентификации, разделяющая пользователей на "администраторов" и "пользователей" с разными правами доступа.
    -   **Как работает:**
        1.  **Страница входа:** При первом входе в приложение теперь отображается страница `LoginPage` с формой для ввода логина и пароля.
        2.  **Роли пользователей:**
            -   **Администратор:** Учетные данные задаются в файле `.env` на бэкенде. Администратор имеет полный доступ, включая новую страницу **"Управление пользователями"** в сайдбаре.
            -   **Пользователь:** Учетные данные создаются администратором. Пользователь имеет доступ ко всем основным функциям, но не видит разделы управления.
        3.  **Управление пользователями:** На новой странице администратор может создавать, редактировать (ФИО, логин, пароль) и удалять учетные записи пользователей. Все изменения сохраняются в новой таблице `users` в базе данных.
        4.  **Безопасность сессии:** Данные о вошедшем пользователе хранятся в `sessionStorage`, обеспечивая безопасность и автоматический выход при закрытии вкладки.
    -   **Что дает пользователям:** Обеспечивает безопасный доступ к приложению, позволяет гибко управлять правами и учетными записями, делая систему готовой к использованию в команде.

## Версия 1.39.0 - 2024-08-02

-   **Улучшение UX: Автоматическая прокрутка при добавлении тегов и переменных**
    -   **Что сделано:** Устранено неудобство в модальном окне настроек проекта. Теперь при добавлении нового тега или переменной, если список становится достаточно длинным для появления прокрутки, он автоматически прокручивается вниз.
    -   **Что дает пользователям:** Больше не нужно вручную прокручивать список, чтобы найти и отредактировать только что добавленную пустую строку. Это делает процесс добавления данных более быстрым, плавным и интуитивным.

## Версия 1.38.0 - 2024-08-02

-   **Улучшение UX: Блокировка перетаскивания в режиме выбора**
    -   **Что сделано:** Добавлена явная проверка, которая надежно блокирует возможность перетаскивания (drag-n-drop) карточек постов и заметок, когда включен режим массового выбора.
    -   **Что дает пользователям:** Предотвращает случайные перемещения элементов при попытке их выделить, делая интерфейс более предсказуемым и защищенным от ошибок.

## Версия 1.37.0 - 2024-08-02

-   **Новый функционал: Выбор места назначения при копировании постов**
    -   **Что внедрено:** В модальное окно подтверждения, которое появляется при перетаскивании поста, добавлена новая опция. Теперь, если пользователь активирует переключатель "Копировать", появляется дополнительный выбор: "В систему" или "В отложку VK".
    -   **Как работает:** Этот новый элемент управления (сегментированный переключатель) позволяет пользователю явно указать, куда будет сохранена копия поста. По умолчанию выбрана опция "В систему", что сохраняет текущее поведение. Если выбрать "В отложку VK", копия будет создана в стандартной отложенной очереди VK. Эта опция появляется только при копировании постов и не затрагивает заметки.
    -   **Что дает пользователям:** Предоставляет больше контроля и гибкости в процессе планирования контента, позволяя на лету выбирать наиболее подходящий метод отложенной публикации.

## Версия 1.36.0 - 2024-08-02

-   **Улучшение UX: Блокировка сохранения во время загрузки файлов**
    -   **Что сделано:** Реализована блокировка кнопки "Сохранить"/"Запланировать" в модальном окне поста на время загрузки изображений с компьютера.
    -   **Как работает сейчас:** Когда пользователь выбирает файлы для загрузки, кнопка сохранения становится неактивной и отображает лоадер. Она снова становится доступной только после того, как все файлы будут успешно загружены на сервер.
    -   **Что дает пользователям:** Повышает надежность и предотвращает потерю данных. Эта мера гарантирует, что пост не будет сохранен с неполным набором изображений, если пользователь нажмет "Сохранить" до завершения загрузки.

## Версия 1.35.1 - 2024-08-02

-   **Исправление: Корректное сохранение изображений из галереи**
    -   **Что исправлено:** Устранен критический баг рассинхронизации, из-за которого изображения, добавленные в пост из галереи, не сохранялись при публикации.
    -   **Как работает сейчас:** Компонент `PostMediaSection` был полностью переработан. Он больше не хранит собственную, изолированную копию списка изображений. Вместо этого он работает как "управляемый" компонент: напрямую получает список изображений через `props` от родителя (`PostDetailsModal`) и сообщает об изменениях через колбэк `onImagesChange`.
    -   **Что дает пользователям:** Полная предсказуемость и надежность. Теперь то, что пользователь видит в интерфейсе, — это именно то, что будет сохранено. Изображения из галереи корректно добавляются к посту и отправляются на сервер.

## Версия 1.35.0 - 2024-08-02

-   **Улучшение UI/UX: Адаптивная панель управления в календаре**
    -   **Что сделано:** Панель управления в шапке календаря (`ScheduleHeader`) была полностью переработана для обеспечения корректной работы на экранах разной ширины.
    -   **Как работает сейчас:** Все элементы управления разделены на две логические группы: "Навигация" (выбор даты, недели) и "Действия" (обновление, фильтры, выбор). При сужении экрана элементы внутри группы "Действия" сначала переносятся на новую строку, а при очень узком экране вся группа "Действия" целиком перемещается под блок навигации.
    -   **Что дает пользователям:** Гарантирует, что все инструменты управления календарем остаются видимыми и доступными даже на маленьких экранах или при изменении размера окна браузера. Интерфейс стал более гибким и удобным.

## Версия 1.34.0 - 2024-08-02

-   **Новый функционал: Два режима отображения календаря ("Неделя" и "Сегодня")**
    -   **Что внедрено:** В шапку календаря добавлен переключатель, позволяющий пользователю выбирать между двумя режимами отображения недельной сетки.
    -   **Как работает:**
        1.  **"Неделя" (стандартный режим):** Календарь всегда начинается с понедельника текущей недели (с учетом смещения).
        2.  **"Сегодня" (новый режим):** Календарь начинается с сегодняшнего дня и показывает следующие 6 дней. Это особенно удобно для планирования в конце недели.
        -   **Сохранение выбора:** Выбранный режим сохраняется в `localStorage`, поэтому приложение "запоминает" предпочтения пользователя между сессиями.
        -   **Сброс навигации:** При переключении между режимами недельное смещение автоматически сбрасывается для более предсказуемого поведения.
    -   **Что дает пользователям:** Повышает гибкость и удобство планирования. Режим "Сегодня" позволяет быстрее ориентироваться в ближайших днях, не прокручивая прошедшие дни текущей недели.

## Версия 1.33.0 - 2024-08-02

-   **Улучшение UI/UX: Глобальное модальное окно предпросмотра изображений**
    -   **Что сделано:** Компонент предпросмотра изображений (`ImagePreviewModal`) был полностью переработан для решения целого ряда проблем с UX и визуальным представлением.
    -   **Как работает сейчас:**
        1.  **Технология React Portal:** Компонент теперь использует `createPortal` для рендеринга своего содержимого напрямую в `document.body`. Это гарантирует, что окно предпросмотра всегда будет отображаться **поверх абсолютно всех элементов интерфейса**, включая другие модальные окна и их оверлеи.
        2.  **Корректное закрытие:** Благодаря порталу, клик по оверлею (темной области вне картинки) теперь закрывает **только** окно предпросмотра, не затрагивая и не закрывая родительские модальные окна (например, окно редактирования поста).
        3.  **Обновленный дизайн:** Кнопка закрытия (крестик) была переработана. Теперь это стильный, полупрозрачный круглый элемент, расположенный в правом верхнем углу внутри области просмотра, что соответствует современным стандартам UI.
    -   **Что дает пользователям:** Полностью предсказуемый, надежный и эстетически приятный опыт просмотра изображений. Устранены все проблемы с "прокликиванием" и некорректным z-index, а обновленный дизайн делает интерфейс более современным.
