# Удаление товаров

**Ключевой файл:** `backend_python/services/market_item_delete.py`

Этот модуль отвечает за логику удаления товаров из VK Market и синхронизацию этих изменений с локальной базой данных.

---

## 1. Основные функции

### `delete_market_items(db, project_id, item_ids, user_token)`
-   **Назначение:** Массовое удаление одного или нескольких товаров.
-   **Пошаговая логика (для каждого `item_id` в списке):**
    1.  **Получение данных из кеша:** Перед удалением функция запрашивает товар из локальной БД (`crud.get_market_item_by_vk_id`), чтобы узнать, в каких подборках он состоял. Это нужно для корректного обновления счетчиков.
    2.  **Удаление из VK:** Вызывает метод `market.delete` VK API.
        -   **Обработка ошибок:** Если удаление из VK не удалось, функция **пропускает** этот товар и переходит к следующему, чтобы не создавать рассинхронизацию между VK и локальной БД.
    3.  **Удаление из локальной БД:** Если удаление из VK прошло успешно, вызывает `crud.delete_market_item` для удаления записи из кеша.
    4.  **Обновление счетчиков подборок:** Итерирует по списку подборок, в которых состоял товар (полученному на шаге 1), и вызывает `crud.decrement_market_album_count` для каждой, чтобы уменьшить счетчик товаров в ней.
-   **Связи:**
    -   Вызывается из: `routers/market.py`.
    -   Вызывает: `vk_service.call_vk_api`, `crud.delete_market_item`, `crud.decrement_market_album_count`.