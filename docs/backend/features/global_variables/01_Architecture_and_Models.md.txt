# Глобальные переменные: Архитектура и Модели данных

**Ключевые файлы:** `models.py`, `schemas/base_models.py`

Функционал глобальных переменных построен на двухуровневой архитектуре "Определение-Значение". Это позволяет централизованно управлять *типами* переменных, а значения для них задавать индивидуально для каждого проекта.

---

## 1. Концепция "Определение vs. Значение"

-   **Определение (Definition):** Это "шаблон" или "тип" переменной. Он создается администратором и является глобальным для всей системы. Определение содержит:
    -   **Название:** Понятное имя, которое видит пользователь (например, "Адрес доставки").
    -   **Ключ плейсхолдера:** Уникальный идентификатор, который используется в тексте поста (например, `delivery_address`). В тексте он будет выглядеть как `{global_delivery_address}`.
    -   **Заметка:** Опциональное описание.

-   **Значение (Value):** Это конкретное текстовое значение, которое присваивается "Определению" в рамках одного проекта.
    -   Например, для проекта "Суши-бар 'Сакура'" значение переменной "Адрес доставки" будет "ул. Ленина, 1", а для проекта "Пиццерия 'Марио'" — "пр. Мира, 45".

**Преимущества этого подхода:**
-   **Консистентность:** Все проекты используют одинаковый набор плейсхолдеров.
-   **Централизованное управление:** Администратор может добавить новую переменную (например, "Промокод месяца"), и она автоматически появится в настройках всех проектов.
-   **Гибкость:** Каждый проект имеет свои уникальные значения для глобальных переменных.

---

## 2. Модели данных (Таблицы в БД)

Эта концепция реализована с помощью двух таблиц в базе данных.

### 2.1. `global_variable_definitions`

-   **Модель SQLAlchemy:** `GlobalVariableDefinition` в `models.py`.
-   **Назначение:** Хранит глобальный список всех **определений**.
-   **Структура таблицы:**
    | Поле | Тип SQL | Описание |
    | :--- | :--- | :--- |
    | `id` | `String` | Первичный ключ (UUID). |
    | `name` | `String` | Уникальное название (например, "Основной телефон"). |
    | `placeholder_key` | `String` | Уникальный ключ (например, `main_phone`). |
    | `note` | `Text` | Описание для администратора. |

### 2.2. `project_global_variable_values`

-   **Модель SQLAlchemy:** `ProjectGlobalVariableValue` в `models.py`.
-   **Назначение:** Хранит **значения** переменных для каждого проекта.
-   **Структура таблицы:**
    | Поле | Тип SQL | Описание |
    | :--- | :--- | :--- |
    | `id` | `String` | Первичный ключ (UUID). |
    | `project_id` | `String` | **Внешний ключ** к таблице `projects`. |
    | `definition_id` | `String` | **Внешний ключ** к таблице `global_variable_definitions`. |
    | `value` | `Text` | Конкретное значение (например, "+7 (999) 123-45-67"). |

**Связь:** Таблица `project_global_variable_values` связывает проекты и определения, позволяя каждому проекту иметь свое значение для каждой глобальной переменной.