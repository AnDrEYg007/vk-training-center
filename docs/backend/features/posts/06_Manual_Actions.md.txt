# Ручное управление Системными постами

**Ключевой файл:** `backend_python/services/system_post_service.py`
**Роутер:** `backend_python/routers/system_posts.py`

Этот модуль предоставляет API для выполнения ручных действий над системными постами, позволяя пользователю вмешиваться в их жизненный цикл. Эти функции вызываются кнопками-иконками на карточке системного поста.

---

## 1. Основные функции

### `publish_system_post_now(db, post_id)`
-   **Назначение:** Опубликовать системный пост немедленно, не дожидаясь его запланированного времени.
-   **Эндпоинт:** `POST /api/publishSystemPostNow`
-   **Логика:**
    1.  Находит пост в БД.
    2.  Вызывает `post_service.publish_now`, который выполняет `wall.post` в VK.
    3.  После успешной отправки в VK, меняет статус поста на `publishing` и сохраняет полученный `vk_post_id`.
    4.  Пост переходит под контроль "Пост-трекера" для верификации.
-   **Доступность:** Для постов со статусом `pending_publication`, `error`, `possible_error`.

### `move_to_scheduled(db, post_id)`
-   **Назначение:** "Конвертировать" системный пост в стандартный отложенный пост VK.
-   **Эндпоинт:** `POST /api/moveSystemPostToScheduled`
-   **Логика:**
    1.  Находит системный пост.
    2.  Формирует из его данных объект `schemas.SavePostPayload`.
    3.  Вызывает `post_service.save_post` с флагом `scheduleInVk=True`, который создает пост в отложенной очереди VK.
    4.  После успешного сохранения в VK, **удаляет** исходный системный пост из нашей БД.
-   **Доступность:** Только для постов со статусом `pending_publication`.

### `confirm_publication(db, post_id)`
-   **Назначение:** Вручную подтвердить, что пост со статусом `possible_error` на самом деле опубликован, и убрать его из календаря.
-   **Эндпоинт:** `POST /api/confirmSystemPostPublication`
-   **Логика:** Просто вызывает `crud.delete_system_post`, удаляя запись из таблицы `system_posts`.
-   **Доступность:** Только для постов со статусом `possible_error`.

### `delete_system_post(db, post_id)`
-   **Назначение:** Удалить системный пост. Используется как для обычного удаления, так и для "аварийной" отмены проверки публикации.
-   **Эндпоинт:** `POST /api/deleteSystemPost`
-   **Логика:**
    1.  Проверяет, что статус поста позволяет удаление (нельзя удалить пост в процессе публикации `publishing` через стандартный механизм удаления).
    2.  Вызывает `crud.delete_system_post`.
-   **Доступность:** Для постов со статусом `pending_publication`, `error`, `possible_error`. Фронтенд вызывает этот же эндпоинт для отмены проверки статуса `publishing`.
