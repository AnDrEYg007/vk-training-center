# Вспомогательные функции для постов (Helpers)

**Ключевой файл:** `backend_python/services/post_helpers.py`

Этот модуль содержит небольшие, но важные утилитарные функции, которые переиспользуются в разных сервисах, связанных с постами.

---

## 1. Основные функции

### `assign_tags_to_post(db, post_data, project_id)`
-   **Назначение:** Автоматически присвоить теги посту на основе его текста.
-   **Логика:**
    1.  Получает все теги для проекта из БД (`crud.get_tags_by_project_id`).
    2.  Приводит текст поста к нижнему регистру.
    3.  Итерирует по каждому тегу и ищет его `keyword` в тексте поста.
    4.  **Важно:** Поиск выполняется с использованием **регулярных выражений с границами слова (`\b`)**. Это обеспечивает точное совпадение и предотвращает ложные срабатывания (например, тег "3" не сработает на тексте "33").
    5.  Все найденные теги добавляются в поле `tags` объекта `post_data`.
-   **Связи:** Вызывается из `post_retrieval_service` при обновлении постов из VK и из `post_actions_service` при сохранении.

### `find_conflict_free_time(db, project_id, initial_date_iso, is_new)`
-   **Назначение:** Предотвратить создание постов в уже занятое время.
-   **Логика:**
    1.  Функция срабатывает **только для новых постов** (`is_new=True`). Редактирование существующих постов не затрагивается.
    2.  Получает **все** занятые временные слоты для проекта, запрашивая даты и из отложенных постов VK (`scheduled_posts`), и из системных постов (`system_posts`).
    3.  Проверяет, есть ли `initial_date_iso` в этом наборе.
    4.  Если есть, функция входит в цикл: добавляет 5 минут к дате и проверяет снова, пока не найдет свободный слот.
-   **Возвращает:** Строку с датой в формате ISO, которая гарантированно свободна.
-   **Связи:** Вызывается из `post_actions_service` перед сохранением любого нового поста.