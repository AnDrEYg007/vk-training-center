# Stories Automation (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–π)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Stories (–∏—Å—Ç–æ—Ä–∏–π) –≤ VK –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å—Ç–æ–≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ Stories –ø–æ—Å—Ç—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–ª–∏ –≤—Å–µ –ø–æ—Å—Ç—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.

## üóÇÔ∏è –§–∞–π–ª—ã –º–æ–¥—É–ª—è

```
services/automations/
‚îú‚îÄ‚îÄ stories_service.py              # –§–∞—Å–∞–¥ (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
‚îú‚îÄ‚îÄ stories_background_service.py   # –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ
‚îî‚îÄ‚îÄ stories/
    ‚îú‚îÄ‚îÄ core.py       # process_stories_automation() ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
    ‚îú‚îÄ‚îÄ logic.py      # process_single_story_for_post() ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
    ‚îú‚îÄ‚îÄ stats.py      # batch_update_stats() ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    ‚îî‚îÄ‚îÄ retrieval.py  # get_community_stories() ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π –∏–∑ VK
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

### –ú–æ–¥–µ–ª—å `StoriesAutomation`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | String (PK) | UUID |
| `project_id` | String (FK, unique) | ID –ø—Ä–æ–µ–∫—Ç–∞ |
| `is_active` | Boolean | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è |
| `keywords` | String | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ `*` –¥–ª—è –≤—Å–µ—Ö |
| `created_at` | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | DateTime | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

1. **–†–µ–∂–∏–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤**: `keywords = "–æ—Ç–∑—ã–≤, –∞–∫—Ü–∏—è, –Ω–æ–≤–∏–Ω–∫–∞"`
   - –¢–æ–ª—å–∫–æ –ø–æ—Å—Ç—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
   
2. **–†–µ–∂–∏–º "–í—Å–µ –ø–æ—Å—Ç—ã"**: `keywords = "*"`
   - –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ Stories

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
1. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç job_stories_automation() –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç
   ‚îÇ
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∞–∫—Ç–∏–≤–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π:
   ‚îÇ
   ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–µ –ø–æ—Å—Ç—ã (wall.get) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
   ‚îÇ
   ‚îú‚îÄ –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (–∏–ª–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –≤ —Ä–µ–∂–∏–º–µ "*")
   ‚îÇ
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ –ø–æ—Å—Ç —Ä–∞–Ω–µ–µ (StoriesAutomationLog)
   ‚îÇ
   ‚îî‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Å—Ç–∞:
       ‚îÇ
       ‚îú‚îÄ –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –≤–ª–æ–∂–µ–Ω–∏–π
       ‚îÇ
       ‚îú‚îÄ –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç –ø–æ–≤–µ—Ä—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
       ‚îÇ
       ‚îú‚îÄ –ü—É–±–ª–∏–∫—É–µ–º —á–µ—Ä–µ–∑ stories.getPhotoUploadServer + stories.save
       ‚îÇ
       ‚îî‚îÄ –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ª–æ–≥ (StoriesAutomationLog)
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–¥–µ–ª—å `StoriesAutomationLog`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | String (PK) | UUID |
| `project_id` | String (FK) | ID –ø—Ä–æ–µ–∫—Ç–∞ |
| `vk_post_id` | Integer | ID –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ |
| `created_at` | DateTime | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
| `post_link` | String | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç |
| `post_text` | Text | –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ |
| `image_url` | String | URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| `status` | String | new / processing / commented / error |
| `entry_number` | Integer | –ù–æ–º–µ—Ä –∑–∞–ø–∏—Å–∏ |
| `log` | Text | –î–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `stats` | Text (JSON) | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ |
| `stats_updated_at` | DateTime | –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ |

## üåê API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –†–æ—É—Ç–µ—Ä: `routers/stories_automation.py`

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/api/stories-automation/{project_id}/settings` | –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `POST` | `/api/stories-automation/{project_id}/settings` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| `GET` | `/api/stories-automation/{project_id}/logs` | –ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥ |
| `POST` | `/api/stories-automation/process-manual` | –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–∞ |
| `GET` | `/api/stories-automation/{project_id}/stories` | –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ VK |
| `GET` | `/api/stories-automation/preview/{owner_id}/{story_id}` | –ü—Ä–µ–≤—å—é –∏—Å—Ç–æ—Ä–∏–∏ |

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é

```json
POST /api/stories-automation/{project_id}/settings

{
  "is_active": true,
  "keywords": "–æ—Ç–∑—ã–≤, –Ω–æ–≤–∏–Ω–∫–∞"
}
```

### 2. –†—É—á–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Stories

```json
POST /api/stories-automation/process-manual

{
  "project_id": "uuid-–ø—Ä–æ–µ–∫—Ç–∞",
  "post_id": 12345,
  "owner_id": -123456789
}
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–æ—Å—Ç–µ
- –ù–µ–æ–±—Ö–æ–¥–∏–º —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ `stories`
- VK API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—Ä–∏–π –≤ —Å—É—Ç–∫–∏

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **VK Service**: `vk_service.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ, –ø—É–±–ª–∏–∫–∞—Ü–∏—è
- **Scheduler**: `scheduler_service.py` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: `features/automations/` ‚Äî UI –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 23 —è–Ω–≤–∞—Ä—è 2026*
