# General Contests (–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏)

–ú–æ–¥—É–ª—å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π —Å –≥–∏–±–∫–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —É—á–∞—Å—Ç–∏—è.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:
1. –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ —É—á–∞—Å—Ç–∏—è (–ª–∞–π–∫, —Ä–µ–ø–æ—Å—Ç, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
2. –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç –æ –Ω–∞—á–∞–ª–µ –∫–æ–Ω–∫—É—Ä—Å–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
3. –°–æ–±–∏—Ä–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≤–æ–¥–∏—Ç—å –∏—Ç–æ–≥–∏ –∏ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
5. –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—ã–¥–∞–≤–∞—Ç—å –ø—Ä–∏–∑—ã

## üóÇÔ∏è –§–∞–π–ª—ã –º–æ–¥—É–ª—è

```
services/automations/general/
‚îú‚îÄ‚îÄ service.py       # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞, sync_contest_posts()
‚îú‚îÄ‚îÄ collector.py     # –°–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ VK
‚îú‚îÄ‚îÄ finalizer.py     # –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤, –≤—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
‚îî‚îÄ‚îÄ crud.py          # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
```

## ‚öôÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### `GeneralContest` ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—É—Ä—Å–∞

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | String (PK) | UUID |
| `project_id` | String (FK) | ID –ø—Ä–æ–µ–∫—Ç–∞ |
| `name` | String | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞ |
| `is_active` | Boolean | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ |
| **–¢–∏–ø —Å—Ç–∞—Ä—Ç–∞** | | |
| `start_type` | String | `new_post` / `existing_post` |
| `existing_post_link` | String | –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Å—Ç |
| `start_date` | DateTime | –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ |
| **–ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞** | | |
| `post_text` | Text | –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ |
| `post_media` | Text (JSON) | –ú–µ–¥–∏–∞ –≤–ª–æ–∂–µ–Ω–∏—è |
| **–£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è** | | |
| `conditions` | Text (JSON) | –°–ø–∏—Å–æ–∫ —É—Å–ª–æ–≤–∏–π |
| `required_actions` | String | `like` / `repost` / `comment` / `subscribe` |
| **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** | | |
| `end_type` | String | `date` / `manual` |
| `end_date` | DateTime | –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
| `winners_count` | Integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π |
| **–®–∞–±–ª–æ–Ω—ã** | | |
| `winner_post_text` | Text | –®–∞–±–ª–æ–Ω –ø–æ—Å—Ç–∞ –æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ |
| `winner_dm_text` | Text | –®–∞–±–ª–æ–Ω –õ–° –ø–æ–±–µ–¥–∏—Ç–µ–ª—é |
| `created_at` | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `updated_at` | DateTime | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### `GeneralContestCycle` ‚Äî –¶–∏–∫–ª –∫–æ–Ω–∫—É—Ä—Å–∞

–ö–∞–∂–¥—ã–π –∫–æ–Ω–∫—É—Ä—Å –º–æ–∂–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ (—Ü–∏–∫–ª—ã).

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | String (PK) | UUID |
| `contest_id` | String (FK) | ID –∫–æ–Ω–∫—É—Ä—Å–∞ |
| `status` | String | `created` / `active` / `finished` |
| `started_at` | DateTime | –ù–∞—á–∞–ª–æ —Ü–∏–∫–ª–∞ |
| `finished_at` | DateTime | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ |
| `vk_start_post_id` | Integer | ID —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ VK |
| `start_scheduled_post_id` | String (FK) | ID SystemPost –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ |
| `end_scheduled_post_id` | String (FK) | ID SystemPost –¥–ª—è —Ñ–∏–Ω–∞–ª–∞ |

### `GeneralContestEntry` ‚Äî –£—á–∞—Å—Ç–Ω–∏–∫–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | String (PK) | UUID |
| `cycle_id` | String (FK) | ID —Ü–∏–∫–ª–∞ |
| `user_vk_id` | BigInteger | VK ID —É—á–∞—Å—Ç–Ω–∏–∫–∞ |
| `user_name` | String | –ò–º—è |
| `user_photo` | String | –ê–≤–∞—Ç–∞—Ä |
| `actions_completed` | Text (JSON) | –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è |
| `is_winner` | Boolean | –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ª–∏ |
| `created_at` | DateTime | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–Ω–∫—É—Ä—Å–∞

```
1. –°–û–ó–î–ê–ù–ò–ï (status='created')
   ‚îÇ
   ‚îú‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä—Å
   ‚îÇ
   ‚îú‚îÄ sync_contest_posts() —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç SystemPost –¥–ª—è:
   ‚îÇ   ‚îú‚îÄ –°—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ (–µ—Å–ª–∏ start_type='new_post')
   ‚îÇ   ‚îî‚îÄ –§–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (–ø–æ—Å—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö)
   ‚îÇ
2. –ê–ö–¢–ò–í–ê–¶–ò–Ø (status='active')
   ‚îÇ
   ‚îú‚îÄ –ï—Å–ª–∏ start_type='new_post':
   ‚îÇ   ‚îî‚îÄ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—É–±–ª–∏–∫—É–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–π SystemPost
   ‚îÇ
   ‚îú‚îÄ –ï—Å–ª–∏ start_type='existing_post':
   ‚îÇ   ‚îî‚îÄ –ö–æ–Ω–∫—É—Ä—Å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏
   ‚îÇ
3. –°–ë–û–† –£–ß–ê–°–¢–ù–ò–ö–û–í
   ‚îÇ
   ‚îú‚îÄ collector.py –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç:
   ‚îÇ   ‚îú‚îÄ –õ–∞–π–∫–∏ (wall.getLikes)
   ‚îÇ   ‚îú‚îÄ –†–µ–ø–æ—Å—Ç—ã (wall.getReposts)
   ‚îÇ   ‚îú‚îÄ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (wall.getComments)
   ‚îÇ   ‚îî‚îÄ –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (groups.getMembers)
   ‚îÇ
   ‚îú‚îÄ –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
   ‚îÇ
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ GeneralContestEntry
   ‚îÇ
4. –ó–ê–í–ï–†–®–ï–ù–ò–ï (status='finished')
   ‚îÇ
   ‚îú‚îÄ –ü–æ –¥–∞—Ç–µ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é
   ‚îÇ
   ‚îú‚îÄ finalizer.py:
   ‚îÇ   ‚îú‚îÄ –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
   ‚îÇ   ‚îú‚îÄ –ü—É–±–ª–∏–∫—É–µ—Ç –ø–æ—Å—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
   ‚îÇ   ‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –õ–° –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º
   ‚îÇ
   ‚îî‚îÄ –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π —Ü–∏–∫–ª (–µ—Å–ª–∏ –∫–æ–Ω–∫—É—Ä—Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è)
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ (`sync_contest_posts`)

```python
def sync_contest_posts(db, contest_id):
    """
    1. –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º —Ü–∏–∫–ª
    2. –ï—Å–ª–∏ start_type='new_post':
       - –°–æ–∑–¥–∞—ë–º/–æ–±–Ω–æ–≤–ª—è–µ–º SystemPost –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
    3. –ï—Å–ª–∏ start_type='existing_post':
       - –£–¥–∞–ª—è–µ–º SystemPost (–µ—Å–ª–∏ –±—ã–ª)
       - –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ü–∏–∫–ª
    4. –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç
    """
```

## üåê API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –†–æ—É—Ç–µ—Ä: `routers/automations_general.py`

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/api/general-contests/{project_id}` | –°–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ |
| `POST` | `/api/general-contests/` | –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å |
| `GET` | `/api/general-contests/{id}` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å |
| `PUT` | `/api/general-contests/{id}` | –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å |
| `DELETE` | `/api/general-contests/{id}` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å |
| **–£—á–∞—Å—Ç–Ω–∏–∫–∏** | | |
| `GET` | `/api/general-contests/{id}/entries` | –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| `POST` | `/api/general-contests/{id}/collect` | –°–æ–±—Ä–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ |
| **–î–µ–π—Å—Ç–≤–∏—è** | | |
| `POST` | `/api/general-contests/{id}/finalize` | –ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å |
| `POST` | `/api/general-contests/{id}/reset` | –°–±—Ä–æ—Å–∏—Ç—å –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞ |
| **–ü—Ä–æ–º–æ–∫–æ–¥—ã** | | |
| `GET` | `/api/general-contests/{id}/promo-codes` | –ü—Ä–æ–º–æ–∫–æ–¥—ã –∫–æ–Ω–∫—É—Ä—Å–∞ |
| `POST` | `/api/general-contests/{id}/promo-codes` | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã |

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å

```json
POST /api/general-contests/

{
  "project_id": "uuid-–ø—Ä–æ–µ–∫—Ç–∞",
  "name": "–†–æ–∑—ã–≥—Ä—ã—à iPhone",
  "start_type": "new_post",
  "start_date": "2026-02-01T12:00:00Z",
  "post_text": "üéâ –†–æ–∑—ã–≥—Ä—ã—à iPhone 15!\n\n–£—Å–ª–æ–≤–∏—è:\n‚úÖ –õ–∞–π–∫\n‚úÖ –†–µ–ø–æ—Å—Ç\n‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞",
  "conditions": ["like", "repost", "subscribe"],
  "end_type": "date",
  "end_date": "2026-02-15T18:00:00Z",
  "winners_count": 3,
  "winner_post_text": "üéä –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ —Ä–æ–∑—ã–≥—Ä—ã—à–∞:\n{winners}",
  "winner_dm_text": "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏! –í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: {promo_code}"
}
```

### 2. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

```json
PUT /api/general-contests/{id}
{ "is_active": true }

POST /api/general-contests/{id}/collect
// Response: { "collected": 150, "qualified": 87 }
```

### 3. –ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–æ–Ω–∫—É—Ä—Å

```json
POST /api/general-contests/{id}/finalize
// Response: { 
//   "winners": [
//     { "vk_id": 123, "name": "–ò–≤–∞–Ω" },
//     { "vk_id": 456, "name": "–ú–∞—Ä–∏—è" },
//     { "vk_id": 789, "name": "–ü—ë—Ç—Ä" }
//   ]
// }
```

## ‚ö†Ô∏è –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è

| –£—Å–ª–æ–≤–∏–µ | VK API –º–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------------|----------|
| `like` | `likes.getList` | –õ–∞–π–∫ –Ω–∞ –ø–æ—Å—Ç |
| `repost` | `wall.getReposts` | –†–µ–ø–æ—Å—Ç –∑–∞–ø–∏—Å–∏ |
| `comment` | `wall.getComments` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ–¥ –ø–æ—Å—Ç–æ–º |
| `subscribe` | `groups.isMember` | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ |

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **SystemPost**: –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –ø–æ—Å—Ç—ã (—Å—Ç–∞—Ä—Ç, —Ñ–∏–Ω–∞–ª)
- **PromoCode**: –ø—Ä–æ–º–æ–∫–æ–¥—ã –¥–ª—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- **VK Service**: —Ä–∞–±–æ—Ç–∞ —Å API VK
- **Scheduler**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 23 —è–Ω–≤–∞—Ä—è 2026*
