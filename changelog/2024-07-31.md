# Журнал изменений (Changelog)

Этот файл содержит историю версий и описание основных изменений в приложении "VK Content Helper".

## Версия 1.7.0 - 2024-07-31

-   **Исправление: Улучшена логика AI-коррекции для отзывов**
    -   **Что исправлено:** Устранена проблема, из-за которой при автоматической коррекции текста отзыва AI не всегда правильно формировал хештег и ссылку для оформления заказа.
    -   **Как работает сейчас:** Бэкенд теперь корректно извлекает короткое имя группы (`screen_name`) из VK и ссылку на доставку (`DLVRY`) из переменных проекта. Эти данные передаются в Gemini AI с новой, более строгой инструкцией (промптом), которая четко определяет формат хештега (`#отзыв@screen_name`) и ссылки (`[ссылка|Оформить заказ]`).
    -   **Что дает пользователям:** Функция "Редактор AI" теперь генерирует текст с полностью корректным, кликабельным хештегом и правильной ссылкой на приложение для заказа. Это устраняет необходимость ручных правок и обеспечивает консистентность постов.

## Версия 1.6.0 - 2024-07-31

-   **Улучшение: Повышена стабильность и надежность функции "Умная настройка"**
    -   **Что внедрено:** Реализован комплекс мер для устранения ошибок, возникавших при автоматическом заполнении переменных с помощью AI.
    -   **Как работает сейчас:**
        1.  **Улучшенное логирование:** В консоли бэкенда теперь детально отображаются все шаги: данные, полученные от VK, точный промпт, отправляемый в Gemini, и "сырой" ответ от AI. Это позволяет мгновенно диагностировать проблемы.
        2.  **Надежный парсинг JSON:** Бэкенд теперь "умно" извлекает JSON из ответа Gemini, игнорируя посторонний текст и markdown-форматирование (` ```json...``` `), что полностью решает проблему `Failed to parse JSON`.
        3.  **Скорректированный промпт:** Инструкция для Gemini была уточнена. Теперь AI строго проинструктирован **не предлагать новые переменные**, а только заполнять значения для существующих пустых переменных. Это делает поведение функции более предсказуемым и соответствующим ожиданиям.
    -   **Что дает пользователям:** Функция "Умная настройка" стала значительно более стабильной и надежной. Устранены ошибки 500, а результат работы AI стал более точным и предсказуемым, что повышает удобство использования и экономит время.

## Версия 1.5.0 - 2024-07-31

- **Новый функционал: Создание команд в настройках проекта**
  - **Что внедрено:** Добавлена возможность создавать новые команды прямо из модального окна настроек проекта, что делает управление командами более гибким и интуитивным.
  - **Как работает:** В разделе "Команда" теперь доступна кнопка "+ Создать команду". При нажатии на нее появляется поле для ввода названия. После сохранения новая команда немедленно присваивается текущему проекту и становится доступной для выбора в других проектах.
  - **Что дает пользователям:** Упрощает и ускоряет процесс управления командами. Больше не нужно переключать контекст или обращаться к администратору для создания новой команды — всё можно сделать в одном окне.

## Версия 1.4.0 - 2024-07-31

- **Улучшение: Добавлена обработка колбэков для предложенных постов**
  - **Что изменено:** Бэкенд теперь обрабатывает уведомления от VK о появлении новых предложенных постов (`wall_post_new` с `post_type: 'suggest'`).
  - **Как работает сейчас:** Аналогично механизму для отложенных постов, при получении такого уведомления система немедленно запускает полный запрос к VK API для получения актуального списка *всех* предложенных постов для данного проекта. Это гарантирует, что база данных на бэкенде всегда синхронизирована с VK.
  - **Что дает пользователям:** Новые предложенные посты появляются в интерфейсе приложения практически в реальном времени. Когда пользователь переходит в проект, для которого поступило обновление, он видит актуальные данные и счетчик, что значительно ускоряет модерацию.

## Версия 1.3.1 - 2024-07-31

- **Улучшение: Повышена надежность обработки колбэков для отложенных постов**
  - **Что изменено:** Усовершенствована логика бэкенда при получении уведомлений от VK об изменениях в отложенных публикациях (`postponed_new`, `postponed_delete` и т.д.).
  - **Как работает сейчас:** Вместо того чтобы полагаться на данные из самого уведомления, бэкенд теперь при любом таком событии немедленно выполняет полный запрос к VK API для получения самого свежего и полного списка всех отложенных постов для данного проекта. После этого он полностью обновляет свою базу данных этим списком.
  - **Что дает пользователям:** Этот подход гарантирует 100% консистентность данных между VK и приложением. Он устраняет потенциальные проблемы, когда уведомление от VK могло прийти с задержкой или содержать неполную информацию. Теперь любые изменения, сделанные напрямую в интерфейсе VK, будут надежно и полностью синхронизированы с календарем в приложении.

## Версия 1.3.0 - 2024-07-31

- **Исправление: Корректная перезагрузка данных при обновлении проектов**
  - **Что исправлено:** Устранена проблема, из-за которой после принудительного обновления списка проектов (`handleForceRefreshProjects`) не перезагружались связанные данные (посты, заметки). Это приводило к тому, что при выборе проекта календарь отображался пустым.
  - **Как работает сейчас:** Логика обновления была полностью переработана. Теперь после получения нового списка проектов с бэкенда, приложение автоматически запрашивает все посты (опубликованные, отложенные, предложенные) и заметки для этих проектов. Состояние приложения сбрасывается и заполняется новыми данными, как при первой загрузке.
  - **Что дает пользователям:** Гарантирует полную консистентность данных после обновления. Пользователи всегда видят актуальное и полное расписание для любого проекта, избегая путаницы с пустыми вкладками.

## Версия 1.2.0 - 2024-07-31

- **Новый функционал: Надежная система обновлений через фоновый опрос**
  - **Что внедрено:** Полностью переработан механизм обновления данных, чтобы гарантировать их своевременное появление в интерфейсе после событий на стороне VK (например, публикация нового поста).
  - **Как работает:**
    - **Бэкенд:** При получении колбэка от VK (например, `wall_post_new`) и успешной записи данных в базу, сервер теперь помечает соответствующий проект как "требующий обновления" в специальной таблице. Создан новый эндпоинт `/api/getUpdates`, который отдает список ID "устаревших" проектов.
    - **Фронтенд:** Приложение теперь каждые 5 секунд в фоновом режиме опрашивает эндпоинт `/api/getUpdates`.
    - **UI/UX:** Если для проекта приходят обновления, рядом с его названием в боковой панели появляется синяя пульсирующая точка. При переключении на такой проект мгновенно отображаются старые данные, а в фоне запускается подгрузка новых. Точка сменяется спиннером, а после обновления он исчезает, и в календаре появляется новый контент.
  - **Что дает пользователям:** Эта система обеспечивает надежную и проактивную доставку информации об изменениях. Пользователь видит, что появились новые данные, еще до переключения на проект, а интерфейс при этом остается отзывчивым и не блокируется полноэкранными загрузчиками.

## Версия 1.1.0 - 2024-07-31

- **Новый функционал: Фильтр "Есть посты"**
  - **Что внедрено:** В боковую панель, в секцию фильтров по количеству контента, добавлена кнопка "Есть посты".
  - **Как работает:** При активации этого фильтра в списке проектов остаются только те, у которых счетчик отложенных (в режиме "Отложенные") или предложенных (в режиме "Предложенные") постов больше нуля.
  - **Что дает пользователям:** Позволяет быстро находить проекты, в которых есть контент для работы, например, для разбора предложенных записей. Это ускоряет работу контент-менеджеров и модераторов.
  - **Заметка для бэкенда:** Функционал реализован полностью на стороне фронтенда и не требует изменений в API. Фильтрация происходит на основе уже загруженных с бэкенда счетчиков постов.

## Версия 1.0.0 - 2024-07-31 (Начальная версия)

- **Основной функционал:**
  - Просмотр и управление проектами (сообществами VK).
  - Календарь для планирования отложенных постов.
  - Просмотр опубликованных постов.
  - Создание, редактирование, удаление и копирование постов.
  - Drag-and-drop постов для изменения даты публикации.
  - Поддержка заметок (стикеров) в календаре.
  - Просмотр и AI-коррекция предложенных постов.
  - "Умная" настройка переменных проекта с помощью AI.
  - Интеграция с бэкендом на Python (FastAPI).