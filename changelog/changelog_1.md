# Обновления 1 (Версии 1.0.0 - 1.18.0)

Этот раздел содержит краткий обзор ключевых изменений, сгруппированных по категориям, за период с 31 июля по 1 августа 2024 года.

### Новый функционал

- **Страница управления базой данных проектов** (v1.8.0): Добавлен раздел для массового редактирования и добавления проектов по URL.
- **Продвинутая система тегирования** (v1.12.0, v1.13.0): Реализовано создание, редактирование и автоматическое присвоение множественных тегов постам.
- **Интегрированная Image Gallery** (v1.15.0): Внедрена галерея с альбомами VK, загрузкой и выбором фото прямо в окне поста.
- **Emoji Picker** (v1.16.0): Добавлена панель выбора эмодзи с поиском и категориями.
- **Создание команд** (v1.5.0): Реализована возможность создавать новые команды из настроек проекта.
- **Фильтры** (v1.1.0): Добавлен фильтр "Есть посты" для быстрой навигации.

### Улучшения бэкенда и логики

- **"Умная" загрузка данных** (v1.18.0, v1.9.0): Реализована интеллектуальная загрузка для предложенных постов и автоматическая синхронизация для новых проектов.
- **Надежность фоновых обновлений** (v1.2.0, v1.3.1, v1.4.0): Внедрена система polling'а для отслеживания изменений и улучшена логика обработки колбэков от VK.
- **Стабильность AI-функций** (v1.7.0, v1.6.0): Повышена надежность парсинга ответов от Gemini и улучшены промпты для AI-коррекции и настройки переменных.
- **Обработка ошибок доступа** (v1.14.0): Улучшена логика отслеживания и отображения ошибок, связанных с правами доступа токена.

### Улучшения UI/UX и производительности

- **Устранение "моргания" изображений** (v1.17.0): Окончательно решена проблема с повторной анимацией изображений в календаре.
- **Оптимизация интерфейса** (v1.16.0, v1.11.0, v1.10.0): Добавлена изменяемая ширина колонок в таблице, AI-помощник сделан сворачиваемым, устранен "прыжок" макета при загрузке изображений.
- **Рефакторинг** (v1.10.0): Проведена декомпозиция сложного модального окна `PostDetailsModal` для улучшения читаемости и поддержки кода.

---

## Версия 1.18.0 - 2024-08-01

-   **Улучшение: Внедрена "умная" логика загрузки для предложенных постов**
    -   **Что внедрено:** Логика получения данных для вкладки "Предложенные посты" была полностью переработана и приведена в соответствие с логикой для вкладки "Расписание".
    -   **Как работает сейчас:** Приложение теперь "запоминает" состояние проекта, если в нем нет предложенных постов или если произошла ошибка доступа. В таких случаях автоматические запросы к API больше не выполняются, что снижает нагрузку на сервер и предотвращает повторное появление сообщений об ошибках. Обновление происходит только если данные в кэше устарели, или по запросу пользователя.
    -   **Что дает пользователям:** Работа с предложенными постами стала более стабильной, быстрой и предсказуемой. Интерфейс теперь ведет себя консистентно во всех разделах приложения.

## Версия 1.17.0 - 2024-08-01

-   **Исправление: Полностью устранен эффект "моргания" изображений в календаре**
    -   **Что исправлено:** Устранен интермиттирующий баг, при котором изображения в карточках постов "моргали" (повторно запускали анимацию появления) при изменении состояния родительского компонента, например, при переключении видимости тегов.
    -   **Как работает сейчас:** Проблема была вызвана тем, что дочерние компоненты (`ImageGrid`, `Attachments`, `PostTags`) были определены *внутри* функции рендеринга `PostCard`. Это заставляло React полностью **перемонтировать** их при каждой перерисовке родителя, теряя их внутреннее состояние (включая состояние анимации `LazyImage`). Теперь эти компоненты вынесены за пределы `PostCard`, став стабильными. Это гарантирует, что React будет только **обновлять** их, а не перемонтировать, что окончательно решает проблему "моргания".
    -   **Что дает пользователям:** Полностью плавный и стабильный интерфейс календаря. Любые действия, вызывающие перерисовку сетки, больше не приводят к визуальным артефактам на карточках постов, обеспечивая профессиональный и приятный пользовательский опыт.

## Версия 1.16.0 - 2024-08-01

-   **Новый функционал: Библиотека компонентов и улучшения UX**
    -   **Что внедрено:** Добавлен ряд новых компонентов и улучшений, направленных на повышение удобства и эффективности работы.
    -   **Как работает:**
        1.  **Emoji Picker:** В модальном окне поста, рядом с полем ввода текста, появилась кнопка для вызова панели выбора эмодзи. Панель включает поиск и категории, а также запоминает недавно использованные эмодзи для каждого проекта отдельно.
        2.  **Редактор тегов в настройках:** Компонент `TagsEditor` был интегрирован в модальное окно настроек проекта, позволяя управлять тегами в едином интерфейсе.
        3.  **Изменяемая ширина колонок:** На странице управления базой проектов (`DatabaseManagementPage`) теперь можно изменять ширину колонок таблицы, перетаскивая их границы, что позволяет настроить вид под свои нужды.
    -   **Что дает пользователям:** Эти улучшения делают интерфейс более гибким, функциональным и приятным в использовании, ускоряя рутинные операции.

## Версия 1.15.0 - 2024-08-01

-   **Новый функционал: Интегрированная Image Gallery**
    -   **Что внедрено:** В модальном окне создания/редактирования поста реализована полнофункциональная галерея изображений, позволяющая удобно работать с фотоальбомами VK.
    -   **Как работает:**
        1.  **Просмотр альбомов:** При нажатии на кнопку "Добавить фото" открывается галерея, которая отображает список всех фотоальбомов текущего проекта, включая системные ("Фото со стены").
        2.  **Создание альбомов и загрузка фото:** Прямо из интерфейса галереи можно создать новый фотоальбом или загрузить новые фотографии в существующий. Процесс загрузки отображается в реальном времени.
        3.  **Просмотр и выбор фото:** При выборе альбома отображается сетка фотографий с "бесконечной" прокруткой. Пользователь может выбрать несколько изображений для добавления в пост.
        4.  **Кеширование на бэкенде:** Вся информация об альбомах и фотографиях кешируется в базе данных на бэкенде, что обеспечивает мгновенную загрузку при повторном открытии. Доступны кнопки для принудительного обновления кеша из VK.
    -   **Что дает пользователям:** Устраняет необходимость заранее копировать ссылки на изображения. Весь процесс работы с медиаконтентом теперь происходит в едином, удобном и быстром интерфейсе, что кардинально ускоряет создание постов.

## Версия 1.14.0 - 2024-08-01

-   **Улучшение: Повышена надежность обработки ошибок доступа и актуальности данных**
    -   **Что внедрено:** Реализовано комплексное исправление для устранения бага, при котором ошибка доступа к отложенным постам могла быть ошибочно скрыта после перезагрузки страницы или при массовом обновлении.
    -   **Как работает сейчас:**
        1.  **Бэкенд:** Исправлена критическая ошибка, из-за которой метка времени последнего обновления (`last_update`) устанавливалась даже при неудачном запросе к VK API. Теперь эта метка обновляется **только после успешного получения данных**, что гарантирует корректное определение "устаревших" данных.
        2.  **Фронтенд (Состояние ошибки):** Флаг ошибки доступа теперь хранится в `localStorage`. Это значит, что если ошибка произошла, она будет отображаться даже после перезагрузки страницы, пока проблема не будет решена.
        3.  **Фронтенд (Устранение гонки состояний):** Установлено строгое правило: флаг ошибки доступа может быть снят **только** после **успешного** выполнения функции обновления **отложенных постов** (`handleRefreshScheduled`). Функция обновления опубликованных постов больше не влияет на этот флаг.
    -   **Что дает пользователям:**
        -   Система больше не будет ложно сообщать, что данные актуальны, если при последнем обновлении произошла ошибка.
        -   Баннер с ошибкой доступа теперь будет надежно отображаться до тех пор, пока пользователь не исправит проблему с токеном и не выполнит успешное ручное обновление.
        -   Устранена путаница, когда кнопка "Обновить всё" ошибочно скрывала проблему с доступом. Интерфейс стал более предсказуемым и надежным.

## Версия 1.13.0 - 2024-08-01

-   **Новый функционал: Интегрированное управление тегами в настройках проекта**
    -   **Что внедрено:** В модальное окно настроек проекта (`ProjectSettingsModal`) добавлен новый раздел "Управление тегами" в виде аккордеона.
    -   **Как работает:** Этот раздел полностью повторяет функциональность отдельного модального окна управления тегами. Пользователи могут создавать, редактировать (название, ключевое слово, заметку, цвет) и удалять теги прямо во время настройки проекта. Все изменения, касающиеся тегов, сохраняются одновременно с остальными настройками проекта при нажатии на главную кнопку "Сохранить".
    -   **Что дает пользователям:** Обеспечивает более удобный и контекстный способ управления тегами. Теперь не нужно выходить из настроек проекта, чтобы внести быстрые правки в список тегов, что делает рабочий процесс более гладким и интуитивным.

## Версия 1.12.0 - 2024-08-01

-   **Новый функционал: Продвинутая система тегирования постов**
    -   **Что внедрено:** Реализована полнофункциональная система тегов, которая позволяет более гибко и точно категоризировать контент.
    -   **Как работает:**
        1.  **Множественные теги:** Теперь каждому посту (как отложенному, так и опубликованному) можно присвоить неограниченное количество тегов, а не один.
        2.  **Автоматическое присвоение:** При обновлении постов из VK, система автоматически сканирует текст каждого поста и присваивает ему **все** теги, чьи ключевые слова найдены в тексте.
        3.  **Управление тегами:** В шапке календаря появилась новая кнопка "Управление тегами" (с иконкой метки). Она открывает модальное окно, где можно:
            -   Создавать новые теги, задавая им название, ключевое слово для поиска, цвет и внутреннюю заметку.
            -   Редактировать и удалять существующие теги.
            -   Сохранять все изменения одним нажатием.
        4.  **Массовое пере-тегирование:** В окне управления тегами доступна кнопка "Обновить теги для всех постов", которая принудительно запускает процесс пере-сканирования и пере-присвоения тегов для всех постов в текущем проекте.
        5.  **Визуализация:** Карточка поста в календаре теперь отображает все присвоенные теги в виде цветных плашек. Цвет текста на плашке автоматически подбирается (черный или белый) для лучшей читаемости.
    -   **Что дает пользователям:** Эта система превращает теги из простого индикатора в мощный инструмент организации контента. Она закладывает основу для будущих функций, таких как фильтрация и поиск постов по тегам, и делает визуальное представление календаря более информативным.

## Версия 1.11.0 - 2024-08-01

-   **Улучшение UX: Сворачиваемый AI-помощник**
    -   **Что внедрено:** В модальном окне создания/редактирования поста блок "AI-помощник" теперь по умолчанию скрыт, аналогично блоку "Переменные".
    -   **Как работает:** Рядом с кнопкой "Переменные" появилась новая кнопка "AI-помощник". Нажатие на нее плавно открывает или закрывает соответствующий блок.
    -   **Что дает пользователям:** Интерфейс стал чище и менее перегруженным. Пользователи могут открывать AI-инструменты только тогда, когда они им действительно нужны, что освобождает ценное пространство на экране для работы с текстом поста.

## Версия 1.10.0 - 2024-08-01

-   **Улучшение UX: Устранение "прыжка" интерфейса при загрузке одиночных изображений**
    -   **Что исправлено:** Исправлена проблема, из-за которой карточка поста (`PostCard`) с одним изображением резко меняла свой размер после загрузки картинки, вызывая смещение контента (layout shift).
    -   **Как работает сейчас:** Для постов с одним изображением теперь заранее резервируется пространство с фиксированным соотношением сторон (16:9). Сначала на этом месте отображается скелетон-загрузчик, а затем, после загрузки, на его месте плавно появляется само изображение.
    -   **Что дает пользователям:** Интерфейс стал более стабильным и профессиональным. Отсутствие "прыжков" контента делает взаимодействие с календарем более плавным и приятным.

-   **Рефакторинг: Декомпозиция модального окна `PostDetailsModal`**
    -   **Что сделано:** Внутренняя структура одного из самых сложных компонентов приложения, `PostDetailsModal`, была полностью переработана. Его монолитная логика была разделена на несколько небольших, сфокусированных дочерних компонентов (`PostTextSection`, `PostMediaSection`, `PostDateTimePicker`, `PostCreationOptions` и др.).
    -   **Зачем это нужно:** Этот рефакторинг не меняет внешний вид или функциональность, но значительно улучшает качество кодовой базы. Код стал более читаемым, его легче поддерживать и расширять в будущем. Каждый компонент теперь отвечает за свою четко определенную часть интерфейса, что соответствует лучшим практикам React-разработки.

## Версия 1.9.0 - 2024-08-01

-   **Новый функционал: Автоматическая загрузка данных для новых проектов**
    -   **Что внедрено:** Реализован "умный" механизм, который автоматически подгружает все необходимые данные при первом открытии нового, еще не синхронизированного проекта.
    -   **Как работает:** Когда пользователь выбирает в сайдбаре проект, для которого в приложении еще нет данных (например, только что добавленный через страницу управления БД), система автоматически запускает фоновую загрузку полного набора данных для этого проекта из VK: опубликованные, отложенные и предложенные посты, а также заметки. Пользователь при этом видит индикатор загрузки только на самом проекте, а не на всем экране.
    -   **Что дает пользователям:** Это создает более плавный и интуитивный пользовательский опыт. Больше не нужно вручную нажимать кнопку "Обновить" для каждого нового проекта. Приложение само заботится о том, чтобы данные были загружены, делая работу с новыми проектами быстрой и бесшовной.

## Версия 1.8.0 - 2024-08-01

-   **Новый функционал: Страница управления базой данных проектов**
    -   **Что внедрено:** Добавлен новый полноэкранный раздел для централизованного управления всеми проектами в системе. Это мощный инструмент для администраторов и менеджеров, позволяющий выполнять массовые операции.
    -   **Как работает:**
        1.  **Доступ:** В шапке сайдбара, рядом с кнопкой обновления списка проектов, появилась новая иконка "базы данных". Нажатие на нее переводит приложение в новый режим "Управление базой проектов".
        2.  **Редактируемая таблица:** На странице отображается таблица со всеми проектами. Ключевые поля, такие как "Название проекта", "Команда", "Статус" (активен/отключен), "Заметки" и "Код Callback API", доступны для редактирования прямо в ячейках таблицы.
        3.  **Массовое сохранение:** Любые изменения отслеживаются. При наличии несохраненных правок вверху страницы появляется панель с кнопками "Сохранить" и "Отменить", позволяя применить все изменения одним запросом.
        4.  **Добавление проектов:** Кнопка "+ Добавить проекты" открывает модальное окно, куда можно вставить список ссылок на сообщества VK (по одной на строку). Система автоматически обработает ссылки, получит актуальные данные из VK, отсеет дубликаты и добавит только новые проекты в базу.
        5.  **Управление колонками:** Добавлена кнопка "Колонки", которая открывает выпадающее меню для включения/отключения видимости колонок в таблице. Ширину колонок также можно изменять, перетаскивая их границы.
    -   **Что дает пользователям:**
        -   **Эффективность:** Значительно ускоряет процесс редактирования настроек для множества проектов, так как больше не нужно заходить в настройки каждого проекта по отдельности.
        -   **Удобство:** Упрощает и автоматизирует добавление новых проектов в систему. Достаточно просто скопировать список ссылок.
        -   **Наглядность:** Предоставляет полный обзор всех проектов и их текущих настроек на одном экране с возможностью настроить отображение под свои нужды.

## Версия 1.7.0 - 2024-07-31

-   **Исправление: Улучшена логика AI-коррекции для отзывов**
    -   **Что исправлено:** Устранена проблема, из-за которой при автоматической коррекции текста отзыва AI не всегда правильно формировал хештег и ссылку для оформления заказа.
    -   **Как работает сейчас:** Бэкенд теперь корректно извлекает короткое имя группы (`screen_name`) из VK и ссылку на доставку (`DLVRY`) из переменных проекта. Эти данные передаются в Gemini AI с новой, более строгой инструкцией (промптом), которая четко определяет формат хештега (`#отзыв@screen_name`) и ссылки (`[ссылка|Оформить заказ]`).
    -   **Что дает пользователям:** Функция "Редактор AI" теперь генерирует текст с полностью корректным, кликабельным хештегом и правильной ссылкой на приложение для заказа. Это устраняет необходимость ручных правок и обеспечивает консистентность постов.

## Версия 1.6.0 - 2024-07-31

-   **Улучшение: Повышена стабильность и надежность функции "Умная настройка"**
    -   **Что внедрено:** Реализован комплекс мер для устранения ошибок, возникавших при автоматическом заполнении переменных с помощью AI.
    -   **Как работает сейчас:**
        1.  **Улучшенное логирование:** В консоли бэкенда теперь детально отображаются все шаги: данные, полученные от VK, точный промпт, отправляемый в Gemini, и "сырой" ответ от AI. Это позволяет мгновенно диагностировать проблемы.
        2.  **Надежный парсинг JSON:** Бэкенд теперь "умно" извлекает JSON из ответа Gemini, игнорируя посторонний текст и markdown-форматирование (` ```json...``` `), что полностью решает проблему `Failed to parse JSON`.
        3.  **Скорректированный промпт:** Инструкция для Gemini была уточнена. Теперь AI строго проинструктирован **не предлагать новые переменные**, а только заполнять значения для существующих пустых переменных. Это делает поведение функции более предсказуемым и соответствующим ожиданиям.
    -   **Что дает пользователям:** Функция "Умная настройка" стала значительно более стабильной и надежной. Устранены ошибки 500, а результат работы AI стал более точным и предсказуемым, что повышает удобство использования и экономит время.

## Версия 1.5.0 - 2024-07-31

- **Новый функционал: Создание команд в настройках проекта**
  - **Что внедрено:** Добавлена возможность создавать новые команды прямо из модального окна настроек проекта, что делает управление командами более гибким и интуитивным.
  - **Как работает:** В разделе "Команда" теперь доступна кнопка "+ Создать команду". При нажатии на нее появляется поле для ввода названия. После сохранения новая команда немедленно присваивается текущему проекту и становится доступной для выбора в других проектах.
  - **Что дает пользователям:** Упрощает и ускоряет процесс управления командами. Больше не нужно переключать контекст или обращаться к администратору для создания новой команды — всё можно сделать в одном окне.

## Версия 1.4.0 - 2024-07-31

- **Улучшение: Добавлена обработка колбэков для предложенных постов**
  - **Что изменено:** Бэкенд теперь обрабатывает уведомления от VK о появлении новых предложенных постов (`wall_post_new` с `post_type: 'suggest'`).
  - **Как работает сейчас:** Аналогично механизму для отложенных постов, при получении такого уведомления система немедленно запускает полный запрос к VK API для получения актуального списка *всех* предложенных постов для данного проекта. Это гарантирует, что база данных на бэкенде всегда синхронизирована с VK.
  - **Что дает пользователям:** Новые предложенные посты появляются в интерфейсе приложения практически в реальном времени. Когда пользователь переходит в проект, для которого поступило обновление, он видит актуальные данные и счетчик, что значительно ускоряет модерацию.

## Версия 1.3.1 - 2024-07-31

- **Улучшение: Повышена надежность обработки колбэков для отложенных постов**
  - **Что изменено:** Усовершенствована логика бэкенда при получении уведомлений от VK об изменениях в отложенных публикациях (`postponed_new`, `postponed_delete` и т.д.).
  - **Как работает сейчас:** Вместо того чтобы полагаться на данные из самого уведомления, бэкенд теперь при любом таком событии немедленно выполняет полный запрос к VK API для получения самого свежего и полного списка всех отложенных постов для данного проекта. После этого он полностью обновляет свою базу данных этим списком.
  - **Что дает пользователям:** Этот подход гарантирует 100% консистентность данных между VK и приложением. Он устраняет потенциальные проблемы, когда уведомление от VK могло прийти с задержкой или содержать неполную информацию. Теперь любые изменения, сделанные напрямую в интерфейсе VK, будут надежно и полностью синхронизированы с календарем в приложении.

## Версия 1.3.0 - 2024-07-31

- **Исправление: Корректная перезагрузка данных при обновлении проектов**
  - **Что исправлено:** Устранена проблема, из-за которой после принудительного обновления списка проектов (`handleForceRefreshProjects`) не перезагружались связанные данные (посты, заметки). Это приводило к тому, что при выборе проекта календарь отображался пустым.
  - **Как работает сейчас:** Логика обновления была полностью переработана. Теперь после получения нового списка проектов с бэкенда, приложение автоматически запрашивает все посты (опубликованные, отложенные, предложенные) и заметки для этих проектов. Состояние приложения сбрасывается и заполняется новыми данными, как при первой загрузке.
  - **Что дает пользователям:** Гарантирует полную консистентность данных после обновления. Пользователи всегда видят актуальное и полное расписание для любого проекта, избегая путаницы с пустыми вкладками.

## Версия 1.2.0 - 2024-07-31

- **Новый функционал: Надежная система обновлений через фоновый опрос**
  - **Что внедрено:** Полностью переработан механизм обновления данных, чтобы гарантировать их своевременное появление в интерфейсе после событий на стороне VK (например, публикация нового поста).
  - **Как работает:**
    - **Бэкенд:** При получении колбэка от VK (например, `wall_post_new`) и успешной записи данных в базу, сервер теперь помечает соответствующий проект как "требующий обновления" в специальной таблице. Создан новый эндпоинт `/api/getUpdates`, который отдает список ID "устаревших" проектов.
    - **Фронтенд:** Приложение теперь каждые 5 секунд в фоновом режиме опрашивает эндпоинт `/api/getUpdates`.
    - **UI/UX:** Если для проекта приходят обновления, рядом с его названием в боковой панели появляется синяя пульсирующая точка. При переключении на такой проект мгновенно отображаются старые данные, а в фоне запускается подгрузка новых. Точка сменяется спиннером, а после обновления он исчезает, и в календаре появляется новый контент.
  - **Что дает пользователям:** Эта система обеспечивает надежную и проактивную доставку информации об изменениях. Пользователь видит, что появились новые данные, еще до переключения на проект, а интерфейс при этом остается отзывчивым и не блокируется полноэкранными загрузчиками.

## Версия 1.1.0 - 2024-07-31

- **Новый функционал: Фильтр "Есть посты"**
  - **Что внедрено:** В боковую панель, в секцию фильтров по количеству контента, добавлена кнопка "Есть посты".
  - **Как работает:** При активации этого фильтра в списке проектов остаются только те, у которых счетчик отложенных (в режиме "Отложенные") или предложенных (в режиме "Предложенные") постов больше нуля.
  - **Что дает пользователям:** Позволяет быстро находить проекты, в которых есть контент для работы, например, для разбора предложенных записей. Это ускоряет работу контент-менеджеров и модераторов.
  - **Заметка для бэкенда:** Функционал реализован полностью на стороне фронтенда и не требует изменений в API. Фильтрация происходит на основе уже загруженных с бэкенда счетчиков постов.

## Версия 1.0.0 - 2024-07-31 (Начальная версия)

- **Основной функционал:**
  - Просмотр и управление проектами (сообществами VK).
  - Календарь для планирования отложенных постов.
  - Просмотр опубликованных постов.
  - Создание, редактирование, удаление и копирование постов.
  - Drag-and-drop постов для изменения даты публикации.
  - Поддержка заметок (стикеров) в календаре.
  - Просмотр и AI-коррекция предложенных постов.
  - "Умная" настройка переменных проекта с помощью AI.
  - Интеграция с бэкендом на Python (FastAPI).