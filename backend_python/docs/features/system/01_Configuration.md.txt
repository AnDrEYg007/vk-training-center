# Конфигурация и переменные окружения

**Ключевой файл:** `backend_python/config.py.txt`
**Файл с секретами (локально):** `backend_python/.env`

Этот документ описывает, как бэкенд управляет настройками и секретными ключами для работы в различных окружениях (локальная разработка, продакшен).

---

## 1. Общая концепция

Система использует библиотеку `pydantic-settings` для декларативного управления конфигурацией. Все настройки определены в классе `Settings` в `config.py.txt`.

### 1.1. Иерархия источников

Pydantic автоматически ищет значения для полей класса `Settings` в следующем порядке (сверху вниз, более высокий приоритет перезаписывает нижний):

1.  **Переменные окружения операционной системы:** Это основной способ конфигурации в "боевом" окружении (например, в Yandex Cloud Containers).
2.  **Файл `.env`:** Это основной способ конфигурации для **локальной разработки**. Файл `.env` находится в папке `backend_python` и **не должен** попадать в систему контроля версий (он добавлен в `.gitignore`).
3.  **Значения по умолчанию:** Заданы прямо в коде класса `Settings` (например, `admin_username: str = "admin"`).

**Пример:** Если в `.env` задан `ADMIN_USERNAME="local_admin"`, а в переменных окружения контейнера `ADMIN_USERNAME="prod_admin"`, то в контейнере будет использоваться `"prod_admin"`.

---

## 2. Ключевые переменные конфигурации

| Переменная | Описание | Пример значения |
| :--- | :--- | :--- |
| `VK_USER_TOKEN` | **(Обязательно)** Сервисный токен доступа пользователя VK. Используется для большинства запросов к VK API. | `vk1.a.AbCd...` |
| `GEMINI_API_KEY` | **(Обязательно)** API-ключ от Google AI Studio для доступа к Gemini. | `AIzaSy...` |
| `ADMIN_USERNAME` | Логин администратора системы. По умолчанию: `"admin"`. | `my_admin` |
| `ADMIN_PASSWORD` | Пароль администратора системы. По умолчанию: `"admin"`. | `super_secret_pass` |
| `DATABASE_URL` | **(Опционально)** Строка для подключения к PostgreSQL. Если она **не задана**, приложение автоматически переключается на использование локальной SQLite. | `postgresql+psycopg2://user:pass@host/dbname` |
| `GEMINI_PROXY_URL` | **(Опционально)** URL SOCKS5 прокси-сервера для обхода геоблокировок Gemini. | `http://user:pass@proxy.market:8000` |

---

## 3. Сценарии использования

### 3.1. Локальная разработка

-   **Цель:** Быстрый запуск и отладка на машине разработчика.
-   **Конфигурация:**
    -   Создается файл `.env` на основе `.env.example`.
    -   В `.env` прописываются `VK_USER_TOKEN` и `GEMINI_API_KEY`.
    -   Переменная `DATABASE_URL` **остается пустой или закомментированной**.
-   **Результат:** Бэкенд запускается, используя токены из `.env` и автоматически создает/подключается к локальной базе данных `vk_planner.db` (SQLite).

### 3.2. Продакшен (Yandex Cloud Containers)

-   **Цель:** Работа в "боевом" режиме с высокой надежностью.
-   **Конфигурация:**
    -   Файл `.env` **не используется и не загружается** в контейнер.
    -   Все переменные (`VK_USER_TOKEN`, `GEMINI_API_KEY`, `ADMIN_USERNAME`, `ADMIN_PASSWORD`, `DATABASE_URL`, `GEMINI_PROXY_URL`) передаются в контейнер через **переменные окружения** в настройках ревизии Yandex Cloud Containers.
-   **Результат:** Бэкенд запускается, используя секреты из переменных окружения и подключается к управляемой базе данных PostgreSQL.