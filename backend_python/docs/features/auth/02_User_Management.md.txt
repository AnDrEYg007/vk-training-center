# Управление пользователями

**Ключевой файл:** `backend_python/services/user_service.py.txt`

Этот модуль содержит бизнес-логику для CRUD-операций с пользователями, доступных только администратору.

---

## 1. Основные функции

### `get_all_users(db)`
-   **Назначение:** Получить список всех пользователей (кроме администратора, который не хранится в БД).
-   **Логика:** Просто вызывает `crud.get_all_users`.

### `update_users(db, users_data)`
-   **Назначение:** Выполнить массовое обновление, создание и удаление пользователей.
-   **Логика:** Делегирует всю сложную логику `crud.update_users`.

---

## 2. Логика CRUD (`crud/user_crud.py.txt`)

### `update_users(db, users_data)`
-   **Назначение:** Синхронизировать таблицу `users` с состоянием, пришедшим от фронтенда.
-   **Пошаговая логика:**
    1.  **Получение ID:** Собирает два множества ID: те, что сейчас в БД, и те, что пришли от фронтенда.
    2.  **Удаление:** Находит разницу множеств (`ids_to_delete = all_current_user_ids - all_incoming_user_ids`) и выполняет `DELETE ... WHERE id IN (...)` для удаления пользователей, которых убрали из списка на фронтенде.
    3.  **Обновление и Создание:** Итерирует по списку `users_data` от фронтенда:
        -   Если ID **начинается с `new-`**, это новый пользователь. Создает новую запись `models.User` и добавляет ее в сессию.
        -   Если ID **существующий**, находит этого пользователя в БД и обновляет его поля (`full_name`, `username`, `password`). Пароль обновляется только если он был явно передан.
    4.  **Сохранение:** Выполняет `db.commit()` для применения всех изменений.