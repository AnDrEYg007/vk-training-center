# 3. API и Валидация данных

Этот документ объясняет, как FastAPI и Pydantic работают вместе для создания надежного и самодокументируемого API.

## 1. FastAPI: Роутинг и эндпоинты

FastAPI использует декораторы для объявления API-эндпоинтов. Эти декораторы находятся в файлах внутри папки `routers/`.

**Пример из `routers/posts.py.txt`:**
```python
@router.post("/savePost", response_model=schemas.ScheduledPost)
def save_post(payload: schemas.SavePostPayload, db: Session = Depends(get_db)):
    # ... вызов сервиса
```

-   `@router.post("/savePost")`: Объявляет, что эта функция обрабатывает `POST` запросы на эндпоинт `/api/posts/savePost`.
-   `payload: schemas.SavePostPayload`: FastAPI автоматически берет тело `POST`-запроса, парсит JSON и **валидирует** его на соответствие Pydantic-модели `SavePostPayload`. Если данные неверны (например, не хватает поля или тип не тот), FastAPI автоматически вернет клиенту ошибку `422 Unprocessable Entity` с подробным описанием проблемы.
-   `response_model=schemas.ScheduledPost`: FastAPI гарантирует, что ответ, который вернет эта функция, будет соответствовать структуре `ScheduledPost`. Если ваша функция вернет что-то другое, FastAPI вызовет ошибку. Это также используется для генерации документации.
-   `db: Session = Depends(get_db)`: Механизм внедрения зависимостей, который предоставляет функции доступ к сессии базы данных.

## 2. Pydantic: Схемы и контракт (папка `schemas/`)

Pydantic — это основа валидации. Файлы в папке `schemas/` являются "контрактом" между фронтендом и бэкендом.

-   **Модели-схемы**: Каждый класс, унаследованный от `BaseModel`, определяет структуру данных.
    -   **Схемы для запросов (`api_payloads.py.txt`)**: Определяют, какие данные бэкенд ожидает получить от клиента. Например, `SavePostPayload`.
    -   **Схемы для ответов (`api_responses.py.txt`)**: Определяют, какие данные бэкенд отправит клиенту. Например, `InitialDataResponse`.
    -   **Общие модели данных (`base_models.py.txt`)**: Например, `Project`, `ScheduledPost`. Они используются как в запросах, так и в ответах.
-   **Валидация "из коробки"**: Pydantic автоматически проверяет типы данных, обязательные поля и может выполнять более сложную валидацию с помощью декораторов `@field_validator`.
-   **`model_config = ConfigDict(from_attributes=True)`**: Эта важная строка позволяет Pydantic-модели создаваться напрямую из объекта SQLAlchemy-модели (из `models.py.txt`), автоматически сопоставляя атрибуты.

## 3. Swagger UI: Интерактивная документация

Одно из главных преимуществ FastAPI — автоматическая генерация документации.

-   **Доступ**: После запуска сервера откройте в браузере `http://127.0.0.1:8000/docs`.
-   **Что там есть**:
    -   Полный список всех API эндпоинтов, сгруппированных по тегам.
    -   Для каждого эндпоинта:
        -   Описание.
        -   Структура тела запроса (на основе Pydantic-схем).
        -   Структура возможных ответов.
        -   **Интерактивная форма "Try it out"**, позволяющая отправлять тестовые запросы и видеть реальные ответы прямо из браузера.

**Это единственный актуальный источник правды об API.** Если вы меняете Pydantic-схему в папке `schemas/`, документация обновляется автоматически.
