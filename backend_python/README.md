# Бэкенд на Python для VK Content Planner

Этот бэкенд является реализацией оригинальной логики из Google Apps Script с использованием современного стека Python: FastAPI, SQLAlchemy и SQLite.

## Технологии

- **FastAPI**: Высокопроизводительный веб-фреймворк для создания API.
- **SQLAlchemy**: ORM для взаимодействия с базой данных.
- **SQLite**: Легковесная файловая база данных для хранения всех данных (проекты, посты, заметки).
- **Pydantic**: Для валидации данных и управления настройками.
- **Uvicorn**: ASGI-сервер для запуска FastAPI-приложения.

---

## 1. Первоначальная настройка

### Шаг 1: Переименуйте файлы (ВАЖНО!)

Среда разработки сохраняет файлы Python с расширением `.py.txt`. Перед началом работы их нужно переименовать.

**В папке `backend_python` выполните одну из следующих команд (или переименуйте файлы вручную):**

```bash
# Для macOS / Linux (рекурсивно для всех папок)
find . -name "*.py.txt" -exec sh -c 'mv "$1" "${1%.txt}"' _ {} \;

# Для Windows в PowerShell (рекурсивно для всех папок)
Get-ChildItem -Recurse -Filter *.py.txt | ForEach-Object { Rename-Item -Path $_.FullName -NewName $_.Name.Replace(".py.txt", ".py") }
```

### Шаг 2: Установите Python

Убедитесь, что у вас установлен Python 3.8 или новее.

### Шаг 3: Создайте виртуальное окружение

В терминале, находясь в папке `backend_python`, выполните:

```bash
# Для macOS / Linux
python3 -m venv venv
source venv/bin/activate

# Для Windows
python -m venv venv
.\venv\Scripts\activate
```

### Шаг 4: Установите зависимости

Выполните команду для установки всех необходимых библиотек:

```bash
pip install -r requirements.txt
```

### Шаг 5: Настройте переменные окружения

1.  Создайте файл `.env` в папке `backend_python`, скопировав содержимое из `.env.example`.
2.  Откройте файл `.env` и вставьте ваши реальные токены:

    ```env
    # Сервисный токен пользователя VK с правами доступа к группам
    VK_USER_TOKEN="vk1.a.YOUR_VK_USER_TOKEN..."

    # Ваш API ключ от Google AI Studio для работы с Gemini
    GEMINI_API_KEY="AIzaSy...YOUR_GEMINI_KEY"
    ```

---

## 2. Запуск сервера разработки

Находясь в папке `backend_python` с активированным виртуальным окружением, выполните команду:

```bash
uvicorn main:app --reload
```

- `--reload` автоматически перезапускает сервер при изменении кода.

Сервер будет доступен по адресу `http://127.0.0.1:8000`.

При первом запуске рядом с файлами бэкенда будет автоматически создан файл базы данных `vk_planner.db`.

---

## 3. Взаимодействие с API

### 3.1. Интерактивная документация (Swagger UI)

FastAPI автоматически генерирует интерактивную документацию. Чтобы ее увидеть и протестировать API:

1.  Запустите сервер.
2.  Откройте в браузере `http://127.0.0.1:8000/docs`.

Вы увидите список всех доступных эндпоинтов, сможете посмотреть их структуру и отправлять тестовые запросы прямо из браузера.

### 3.2. Обновление URL на фронтенде

Чтобы фронтенд начал работать с новым бэкендом, откройте файл `shared/config.ts` и убедитесь, что URL правильный:

```typescript
export const GAS_WEB_APP_URL = 'http://127.0.0.1:8000/api';
```

**Важно**: все эндпоинты находятся по пути `/api`, например, `http://127.0.0.1:8000/api/getInitialData`.

## 4. Структура проекта

- `main.py`: Главный файл, роутер API.
- `database.py`: Настройка подключения к БД.
- `models.py`: Описание таблиц БД (ORM-модели SQLAlchemy).
- `schemas.py`: Схемы валидации данных для API (модели Pydantic).
- `crud/`: Папка со слоем доступа к данным (CRUD). Логика разделена на модули по доменным областям (`project_crud.py`, `post_crud.py` и т.д.).
- `vk_service.py`: Модуль для всех вызовов к VK API.
- `gemini_service.py`: Модуль для всех вызовов к Gemini API.
- `config.py`: Загрузка конфигурации из `.env` файла.
- `requirements.txt`: Список зависимостей.
- `.env.example`: Шаблон для файла с секретными ключами.