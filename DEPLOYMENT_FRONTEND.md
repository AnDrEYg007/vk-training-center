# Инструкция по развертыванию фронтенда в Yandex.Cloud S3

Этот документ описывает полный пошаговый процесс сборки и развертывания статичного фронтенд-приложения (React) в бакет Yandex.Cloud S3. Процесс одинаков для **продакшена** и **предпродакшена** окружений, отличается только целевой бакет.

## 1. Концепция

Фронтенд представляет собой набор статических файлов (HTML, CSS, JS), которые генерируются в результате процесса сборки. Эти файлы загружаются в бакет Yandex.Cloud S3, который настроен для раздачи статических сайтов. Браузер пользователя загружает `index.html`, а тот, в свою очередь, подгружает все необходимые CSS и JS-ресурсы.

---

## 2. Предварительные требования

1.  **Node.js и npm**: Установлены на вашем компьютере.
2.  **Yandex Cloud CLI (`yc`)**: Установлен и настроен для работы с вашим облачным аккаунтом.
3.  **Имена бакетов**: Вы должны знать имена ваших S3 бакетов для продакшена и предпродакшена. В этой инструкции мы будем использовать:
    -   **Продакшен**: `s3://vk-content-planner-frontend/`
    -   **Предпродакшен**: `s3://vk-content-planner-frontend-preprod/` (замените на ваше имя, если отличается)

---

## 3. Пошаговый процесс развертывания
Локальная сборка: команды npm run dev -- --host --port 0


### Шаг 1: Сборка проекта

1.  Откройте терминал **в корневой папке проекта** (там, где находится `package.json`).
2.  **Установите или обновите зависимости** (рекомендуется выполнять перед каждой сборкой):
    ```bash
    npm install
    ```
3.  **Запустите сборку проекта**:
    ```bash
    npm run build
    ```
    Эта команда создаст папку `dist` в корне проекта. Внутри нее будут лежать готовый `index.html` и папка `assets` с CSS и JS файлами.

---

### Шаг 2: Загрузка в S3 (Способ 1 - Автоматическая синхронизация)

Это предпочтительный, самый быстрый способ, но он требует относительно свежей версии `yc CLI`, которая поддерживает команду `sync`.

#### Вариант А: Развертывание на **Предпродакшен**

Выполните **одну команду** в терминале (в корне проекта):

```bash
yc storage s3 sync ./dist/ s3://vk-content-planner-frontend-preprod/ --delete
```

#### Вариант Б: Развертывание на **Продакшен**

**ВНИМАНИЕ:** Выполняйте этот шаг только после успешного тестирования на предпродакшене!

Выполните **одну команду** в терминале (в корне проекта):

```bash
yc storage s3 sync ./dist/ s3://vk-content-planner-frontend/ --delete
```

**Что делает эта команда?**
-   `sync ./dist/ s3://.../`: Сравнивает содержимое локальной папки `dist` с содержимым бакета и загружает только новые или измененные файлы.
-   `--delete`: **(Важно!)** Удаляет из бакета файлы, которых больше нет в папке `dist`. Это необходимо для очистки старых версий CSS и JS файлов.

---

### Шаг 2 (Альтернатива): Ручная загрузка файлов (`cp`)

Этот способ является более надежным, так как он работает со всеми версиями `yc CLI` и явно указывает типы файлов, что решает проблемы с MIME-типами.

1.  **Найдите имена файлов:** После сборки откройте папку `dist/assets/` и скопируйте новые имена CSS и JS файлов (например, `index-C6G_3qQV.css` и `index-FADxowQ8.js`).

2.  **Выполните три команды**, подставив правильные имена бакета и файлов.

#### Вариант А: Развертывание на **Предпродакшен**

```bash
# 1. Загрузка HTML
yc storage s3 cp ./dist/index.html s3://vk-content-planner-frontend-preprod/ --content-type "text/html"

# 2. Загрузка JavaScript (замените имя файла)
yc storage s3 cp ./dist/assets/[имя-js-файла].js s3://vk-content-planner-frontend-preprod/assets/ --content-type "application/javascript"

# 3. Загрузка CSS (замените имя файла)
yc storage s3 cp ./dist/assets/[имя-css-файла].css s3://vk-content-planner-frontend-preprod/assets/ --content-type "text/css"
```

#### Вариант Б: Развертывание на **Продакшен**

```bash
# 1. Загрузка HTML
yc storage s3 cp ./dist/index.html s3://vk-content-planner-frontend/ --content-type "text/html"

# 2. Загрузка JavaScript (замените имя файла)
yc storage s3 cp ./dist/assets/[имя-js-файла].js s3://vk-content-planner-frontend/assets/ --content-type "application/javascript"

# 3. Загрузка CSS (замените имя файла)
yc storage s3 cp ./dist/assets/[имя-css-файла].css s3://vk-content-planner-frontend/assets/ --content-type "text/css"
```

**Почему это важно?** Флаг `--content-type` явно указывает серверу, какой тип у файла. Без него сервер может отдать JavaScript как обычный текст (`text/plain`), и браузер откажется его исполнять из соображений безопасности.

---

### Шаг 3: Проверка

1.  Откройте сайт нужного окружения в браузере.
2.  Чтобы убедиться, что загрузилась последняя версия, откройте инструменты разработчика (F12), перейдите на вкладку "Network" (Сеть), поставьте галочку "Disable cache" (Отключить кеш) и обновите страницу.
3.  Проверьте, что приложение работает корректно и нет ошибок в консоли.