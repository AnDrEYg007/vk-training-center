# Процесс разработки и развертывания

Этот документ описывает три основных сценария работы с приложением: локальную разработку, тестирование на предпродакшене и работу в "боевом" (production) окружении.

## 1. Трехступенчатый рабочий процесс

**Локальная разработка -> Предпродакшен (Staging) -> Продакшен (Production)**

Этот подход позволяет безопасно разрабатывать, тестировать и развертывать новые функции.

---

### Сценарий 1: Локальная разработка

Этот сценарий используется для разработки и первоначального тестирования новых функций на локальной машине.

-   **Бэкенд**: Запускается локально (`uvicorn main:app --reload`), использует базу данных SQLite (`vk_planner.db`).
-   **Фронтенд**: Запускается через `npm run dev`. В интерфейсе на странице входа выбирается окружение **"Локальный"**.

---

### Сценарий 2: Предпродакшен (Staging)

Этот сценарий используется для тестирования изменений в среде, максимально приближенной к "боевой", перед выкаткой для всех пользователей.

-   **Бэкенд**: Развернут как отдельный **Yandex Cloud Container** (например, `vk-planner-backend-preprod`). Может использовать ту же базу данных PostgreSQL, что и продакшен, или отдельную тестовую БД.
-   **Фронтенд**: Тот же самый статический сайт. В интерфейсе выбирается окружение **"Предпродакшен"**.

---

### Сценарий 3: Продакшен (Production)

Это "боевое" окружение, с которым работают конечные пользователи.

-   **Бэкенд**: Развернут как основной **Yandex Cloud Container** (`vk-planner-backend`). Использует **Yandex Managed Service for PostgreSQL**.
-   **Фронтенд**: Статический сайт, в интерфейсе которого выбрано окружение **"Продакшен"**.

---

## 2. Архитектура в Yandex.Cloud

![Yandex Cloud Architecture](https://storage.yandexcloud.net/doc-pictures/docs/ru/solutions/images/ci-for-containers-3.png)

1.  **Бэкенд (FastAPI)**:
    -   **Сборка**: Код упаковывается в Docker-образ с помощью `Dockerfile`.
    -   **Хранение**: Docker-образ хранится в **Yandex Container Registry**.
    -   **Выполнение**: Приложение запускается как **Yandex Cloud Container**. Существует как минимум два контейнера: для продакшена и предпродакшена.
    -   **Публичный доступ**: Каждому контейнеру присваивается свой публичный URL.

2.  **База данных**:
    -   **Технология**: **Yandex Managed Service for PostgreSQL**.
    -   **Подключение**: Контейнеры получают строку для подключения к базе данных через переменную окружения `DATABASE_URL`.

3.  **Фронтенд (React)**:
    -   **Размещение**: Единый статический сайт, размещенный на хостинге.
    -   **Подключение**: Фронтенд динамически выбирает, на какой URL бэкенда (продакшен, предпродакшен или локальный) отправлять запросы, на основе выбора пользователя в настройках.